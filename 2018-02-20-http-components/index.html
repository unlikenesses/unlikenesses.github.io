<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.fc76a6e3011e95c33b1f.css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}

/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}a{background-color:transparent}small{font-size:80%}h1,p{margin:0}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e2e8f0}h1{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}.bg-white{--bg-opacity:1;background-color:#fff;background-color:rgba(255,255,255,var(--bg-opacity))}.bg-gray-100{--bg-opacity:1;background-color:#f7fafc;background-color:rgba(247,250,252,var(--bg-opacity))}.bg-gray-300{--bg-opacity:1;background-color:#e2e8f0;background-color:rgba(226,232,240,var(--bg-opacity))}.hover\:bg-gray-400:hover{--bg-opacity:1;background-color:#cbd5e0;background-color:rgba(203,213,224,var(--bg-opacity))}.rounded{border-radius:.25rem}.flex{display:flex}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-between{justify-content:space-between}.font-bold{font-weight:700}.text-sm{font-size:.875rem}.text-lg{font-size:1.125rem}.text-xl{font-size:1.25rem}.text-3xl{font-size:1.875rem}.text-5xl{font-size:3rem}.my-4{margin-top:1rem;margin-bottom:1rem}.mx-auto{margin-left:auto;margin-right:auto}.mr-3{margin-right:.75rem}.p-6{padding:1.5rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.px-4{padding-left:1rem;padding-right:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.pt-2{padding-top:.5rem}.pb-3{padding-bottom:.75rem}.pb-5{padding-bottom:1.25rem}.pl-5{padding-left:1.25rem}.pt-6{padding-top:1.5rem}.pb-6{padding-bottom:1.5rem}.shadow{box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06)}.hover\:shadow-md:hover{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.text-left{text-align:left}.text-gray-600{--text-opacity:1;color:#718096;color:rgba(113,128,150,var(--text-opacity))}.text-gray-700{--text-opacity:1;color:#4a5568;color:rgba(74,85,104,var(--text-opacity))}.text-pink-600{--text-opacity:1;color:#d53f8c;color:rgba(213,63,140,var(--text-opacity))}.hover\:text-gray-700:hover{--text-opacity:1;color:#4a5568;color:rgba(74,85,104,var(--text-opacity))}.hover\:text-gray-800:hover{--text-opacity:1;color:#2d3748;color:rgba(45,55,72,var(--text-opacity))}.uppercase{text-transform:uppercase}.capitalize{text-transform:capitalize}.no-underline{text-decoration:none}.hover\:underline:hover{text-decoration:underline}.w-1\/2{width:50%}.w-full{width:100%}.nunito{font-family:Nunito,sans-serif}p{margin-bottom:.75rem}h2{font-size:1.5rem;font-weight:700;padding-bottom:.75rem}h3{font-size:1.25rem}h3,h4{font-weight:700;padding-top:.75rem;padding-bottom:.75rem}h4{font-size:1.125rem}code{--text-opacity:1;color:#ed64a6;color:rgba(237,100,166,var(--text-opacity));--bg-opacity:1;background-color:#fff5f7;background-color:rgba(255,245,247,var(--bg-opacity));border-radius:.375rem;padding-left:.25rem;padding-right:.25rem}pre code{padding-left:0;padding-right:0}a{color:#ed64a6;color:rgba(237,100,166,var(--text-opacity));text-decoration:underline}a,blockquote{--text-opacity:1}blockquote{--border-opacity:1;border-color:#ed64a6;border-color:rgba(237,100,166,var(--border-opacity));border-left-width:4px;padding-left:1rem;margin-bottom:.75rem;color:#4a5568;color:rgba(74,85,104,var(--text-opacity))}ul{list-style-type:disc;margin-bottom:.5rem}ol,ul{list-style-position:inside}ol{list-style-type:decimal}</style><meta name="generator" content="Gatsby 2.18.17"/><link href="https://fonts.googleapis.com/css?family=Nunito:400,700" rel="stylesheet"/><link as="script" rel="preload" href="/webpack-runtime-9dc4e232ce5257c7390e.js"/><link as="script" rel="preload" href="/commons-e4d1cf937e8afc4814a6.js"/><link as="script" rel="preload" href="/app-d804ca8346e83b6629a1.js"/><link as="script" rel="preload" href="/styles-7cbd95f2e426d3237055.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-f482eaf3e97d399ee61e.js"/><link as="fetch" rel="preload" href="/page-data\2018-02-20-http-components\page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="bg-gray-100 nunito"><div class="container mx-auto flex flex-wrap py-6"><header class="pl-5 pb-6"><a class="font-bold text-gray-700 uppercase hover:text-gray-700 text-5xl no-underline" href="/">Unlikenesses <span class="text-xl">A PHP Developer</span></a><nav><a class="no-underline mr-3 text-gray-600 hover:text-gray-700" href="https://twitter.com/unlikenesses" target="_blank" rel="noopener noreferrer">Twitter</a><a class="no-underline mr-3 text-gray-600 hover:text-gray-700" href="https://github.com/unlikenesses" target="_blank" rel="noopener noreferrer">GitHub</a><a class="no-underline text-gray-600 hover:text-gray-700" href="http://codepen.io/unlikenesses/" target="_blank" rel="noopener noreferrer">CodePen</a></nav></header><section class="w-full flex flex-col items-center px-3"><article class="w-full flex flex-col shadow my-4"><div class="bg-white flex flex-col justify-start p-6"><h1 class="text-3xl font-bold text-gray-700 capitalize">Why an HTTP component?</h1><span class="text-sm pb-3 text-gray-600">20 February, 2018</span><div class="text-gray-700"><p>Patrick Louys <a href="https://github.com/PatrickLouys/no-framework-tutorial/blob/master/04-http.md">recommends</a> using an HTTP interface for dealing with web requests and responses, rather than relying on PHP <a href="http://php.net/manual/en/language.variables.superglobals.php">superglobals</a>. I want to look into why this is, i.e. why packages like <a href="https://github.com/PatrickLouys/http">his</a> (and <a href="https://github.com/symfony/http-foundation">the</a> <a href="https://github.com/nette/http">others</a> <a href="https://github.com/auraphp/Aura.Web">he</a> <a href="https://github.com/fruux/sabre-http">lists</a>) exist.</p>
<p>Let's consider an HTTP request. The PHP global variable for a <code>GET</code> request is <code>$_GET</code>. So if we have a URL like <code>https://unlikenesses.com/?post=32</code>, and we run </p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">echo</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></div>
<p>it will output <code>32</code>. Using the Symfony HTTP component, to get the same result we would run</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">echo</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">query</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'post'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>With Patrick Louys's component, it's </p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">echo</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'post'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Of course, before calling these methods we need to instantiate the request classes, and in both these packages this simply means passing the PHP superglobals to a constructor method; in other words, the request class is basically a wrapper for these globals. This is how it looks in Patrick Louys's package:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token variable">$request</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>Http<span class="token punctuation">\</span>HttpRequest</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">,</span> <span class="token variable">$_COOKIE</span><span class="token punctuation">,</span> <span class="token variable">$_FILES</span><span class="token punctuation">,</span> <span class="token variable">$_SERVER</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>and in Symfony's package (according to the <a href="https://symfony.com/doc/current/components/http_foundation.html">docs</a>):</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token variable">$request</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span>
    <span class="token variable">$_GET</span><span class="token punctuation">,</span>
    <span class="token variable">$_POST</span><span class="token punctuation">,</span>
    <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token variable">$_COOKIE</span><span class="token punctuation">,</span>
    <span class="token variable">$_FILES</span><span class="token punctuation">,</span>
    <span class="token variable">$_SERVER</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The classes then provide methods that allow us to access the globals. Of course, depending on the package, there may be a raft of other helper methods to ease working with requests.</p>
<p>How about response objects? They usually contain three pieces of information: the content of the response, the status code (<code>200</code>, <code>404</code>, etc), and the HTTP headers (e.g. <code>text/html</code>). These packages will contain setter methods to define this information, which can then either be retrieved by getter methods and manually output (as with Patrick Louys's package) or output with <a href="https://symfony.com/doc/current/components/http_foundation.html#sending-the-response">helper methods</a> like <code>send</code> (as with Symfony's package). Such helper methods are basically wrappers around the PHP <code>header</code> and <code>echo</code> commands.</p>
<p>So that's what the packages do. Why are they necessary, or desirable? In the Symfony guide to creating a framework from scratch, a number of problems <a href="https://symfony.com/doc/current/create_framework/http_foundation.html">are raised</a> with using the <code>$_GET</code> superglobal. First, if the given variable doesn't exist, you'll get a PHP warning. This is fixed in the above packages by having their <code>get</code> methods return <code>null</code> (or a given default) if the requested variable name doesn't exist in their <code>GET</code> arrays. E.g., <a href="https://github.com/symfony/http-foundation/blob/8f68c79bce646f965f38f4d892f72128f8a030d8/Request.php#L685-L714">these lines</a> from the Symfony package:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$default</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span> <span class="token operator">!==</span> <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">attributes</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span> <span class="token operator">!==</span> <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">query</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span> <span class="token operator">!==</span> <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token variable">$default</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Next, the Symfony doc points out that blindly accepting variables taking from (e.g.) <code>$_GET</code> leaves your app open to XSS (Cross-Site Scripting). Its short-term fix (i.e. before getting around to using the HTTP package) is this:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token function">header</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Content-Type: text/html; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">printf</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Hello %s'</span><span class="token punctuation">,</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">,</span> <span class="token constant">ENT_QUOTES</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>How does this combat XSS? For a start, it uses <a href="http://php.net/manual/en/function.htmlspecialchars.php">htmlspecialchars</a> to convert any HTML characters (the presence of which might indicate that code is being injected via the query string) to HTML entities (e.g. <code>&#x3C;</code> to <code>&#x26;lt;</code>). The <code>header</code> statement sets encoding to UTF-8 (Owasp <a href="https://www.owasp.org/index.php/PHP_Security_Cheat_Sheet#Use_UTF-8_unless_necessary">notes</a> that "Many new attack vectors rely on encoding bypassing" and recommends to "Use UTF-8 as your database and application charset"). As of PHP 5.4 UTF-8 is default but I guess this allows for security on earlier PHP environments.</p>
<p>How are these issues handled in Symfony's HTTP package? Well, actually it doesn't automatically escape the input for you:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token variable">$response</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Hello %s'</span><span class="token punctuation">,</span> <span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">,</span> <span class="token constant">ENT_QUOTES</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$response</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>But, as the docs say, the <code>send</code> method "first outputs the HTTP headers followed by the content". In any case, since "the charset of the Response object defaults to UTF-8" there is no need to specify it in the <code>Content-Type</code>. </p>
<p>The last benefit mentioned is improved testability. Since these HTTP packages are basically representations of HTTP messages in the form of PHP objects, they can be more easily instantiated, manipulated, mocked, and passed between methods and classes. If we want to test a class that requires a <code>GET</code> variable we can rewrite the class to accept the <code>Request</code> via dependency injection, and in the test mock the <code>Request</code> object and pass it to the class. It's a commonly-held principle of testing that the isolation of functionality allowed by dependency injection increases the testability of your code.</p>
<p>The Symfony HttpFoundation component is used in Symfony (of course), Drupal and Laravel, amongst other frameworks.</p></div></div></article><div class="w-full flex pt-6"><a class="w-1/2 bg-white shadow hover:shadow-md text-left p-6 no-underline" href="/2018-01-10-migrating-blog-to-gatsby/"><p class="text-lg text-gray-700 font-bold flex items-center">Previous<!-- -->:</p><p class="pt-2 capitalize">Migrating the blog from Jekyll to Gatsby<!-- --> <small>10 January, 2018</small></p></a><a class="w-1/2 bg-white shadow hover:shadow-md text-left p-6 no-underline" href="/2018-03-24-laracasts-lessons/"><p class="text-lg text-gray-700 font-bold flex items-center">Next<!-- -->:</p><p class="pt-2 capitalize">Lessons from Laracasts, Part 1<!-- --> <small>24 March, 2018</small></p></a></div></section></div><footer class="container mx-auto flex flex-wrap py-4 px-5 justify-between text-gray-600"><p>Unlikenesses</p><p>Built with <a href="https://www.gatsbyjs.org" target="_blank">GatsbyJS</a> and <a href="https://tailwindcss.com" target="_blank">Tailwind CSS</a></p></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2018-02-20-http-components/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-d804ca8346e83b6629a1.js"],"component---src-templates-index-js":["/component---src-templates-index-js-20aed7baa943eb5e92df.js"],"component---src-templates-post-js":["/component---src-templates-post-js-f482eaf3e97d399ee61e.js"],"component---src-pages-404-js":["/component---src-pages-404-js-224a4a61ab9775ba900d.js"]};/*]]>*/</script><script src="/component---src-templates-post-js-f482eaf3e97d399ee61e.js" async=""></script><script src="/styles-7cbd95f2e426d3237055.js" async=""></script><script src="/app-d804ca8346e83b6629a1.js" async=""></script><script src="/commons-e4d1cf937e8afc4814a6.js" async=""></script><script src="/webpack-runtime-9dc4e232ce5257c7390e.js" async=""></script></body></html>