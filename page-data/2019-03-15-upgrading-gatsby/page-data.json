{"componentChunkName":"component---src-templates-post-js","path":"/2019-03-15-upgrading-gatsby/","result":{"data":{"post":{"html":"<p>Originally this blog was generated by <a href=\"https://jekyllrb.com\">Jekyll</a>, then <a href=\"http://unlikenesses.com/2018-01-10-migrating-blog-to-gatsby/\">a little over a year ago</a> I converted it to <a href=\"https://www.gatsbyjs.org\">Gatsby</a>. Since then Gatsby's moved from v1 to v2, so I want to detail the steps I went through upgrading.</p>\n<h2>What's New</h2>\n<p>According to the <a href=\"https://www.gatsbyjs.org/blog/2018-09-17-gatsby-v2/\">blog post</a> about v2:</p>\n<ul>\n<li>Sites build faster</li>\n<li>The JS core is smaller</li>\n<li>The React dependency moved from 15 to 16</li>\n<li>Improved support for accessibility</li>\n</ul>\n<p>and more, which you can read at the above-linked post.</p>\n<h2>Upgrading</h2>\n<p>So, following the <a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/\">docs</a>, first I upgraded Gatsby:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i gatsby@latest</code></pre></div>\n<p>then my Gatsby packages:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i gatsby-link@latest gatsby-paginate@latest gatsby-plugin-google-analytics@latest gatsby-plugin-google-fonts@latest gatsby-remark-prismjs@latest gatsby-source-filesystem@latest gatsby-transformer-remark@latest</code></pre></div>\n<p>Then, since <code>react</code> and <code>react-dom</code> are no longer part of the <code>gatsby</code> package:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i react react-dom</code></pre></div>\n<p>I then had to go through the plugins and check whether the docs recommended installing extra dependencies for them. The only one that applied was <code>gatsby-remark-prismjs</code>, which required <code>prismjs</code>. I could also remove <code>gatsby-link</code> since it's now part of <code>gatsby</code>. This meant updating my <code>index.js</code> to <a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#import-link-from-gatsby\">import <code>Link</code> from Gatsby</a>.</p>\n<h2>Testing</h2>\n<p>I'd already installed the Gatsby CLI (<code>npm install -g gatsby-cli</code>): to start the dev server, I ran </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">gatsby develop</code></pre></div>\n<p>What I got was an unstyled homepage, without the sidebar. So, the next step was to <a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#3-import-and-wrap-pages-with-the-layout-component\">import the layouts page</a> and wrap my <code>index</code>, <code>page</code> and <code>post</code> pages with it. I then <a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#5-change-query-to-use-staticquery\">changed the query in my layouts page to use StaticQuery</a>. Just to clean things up, I <a href=\"https://www.gatsbyjs.org/docs/migrating-from-v1-to-v2/#explicit-query-names-no-longer-required\">removed any GraphQL query names and the <code>query</code> keyword</a> where applicable.</p>\n<h2>Code formatting</h2>\n<p>The final problem was the code formatting. For some reason, anything between backticks was being strangely formatted with a black background, while code blocks, which were correctly highlighted, nonetheless had a different font (Consolas instead of Courier New). Probably not surprising since my previous version of <code>gatsby-remark-prismjs</code> (the syntax highlighting plugin) was 1.2.9, while the new one is 3.3.18. </p>\n<p>The first problem was solved by adding <code>noInlineHighlight: true</code> to the options for <code>gatsby-remark-prismjs</code> (this wasn't available in the older version). </p>\n<p>My solution to the second problem was a bit hacky. I created a css file to override the prism package's styling:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">code[class*=\"language-\"], pre[class*=\"language-\"]</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> Menlo<span class=\"token punctuation\">,</span> Monaco<span class=\"token punctuation\">,</span> <span class=\"token string\">'Courier New'</span><span class=\"token punctuation\">,</span> monospace<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> 14px<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>...then imported it in my layout file.</p>\n<p><a href=\"https://github.com/unlikenesses/unlikenesses.github.io/tree/v2.1\">Here's the final code</a>.</p>","fields":{"title":"Upgrading Gatsby","date":"15 March, 2019","url":"https://unlikenesses.com/2019-03-15-upgrading-gatsby/"}}},"pageContext":{"slug":"/2019-03-15-upgrading-gatsby/","prev":{"fields":{"title":"Lessons from Laracasts, Part 2","date":"27 April, 2018","slug":"/2018-04-27-laracasts-lessons-part-2/"}},"next":{"fields":{"title":"CI with Jenkins and Symfony","date":"08 October, 2019","slug":"/2019-10-08-jenkins-and-symfony/"}}}}}