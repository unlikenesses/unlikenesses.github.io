{"componentChunkName":"component---src-templates-post-js","path":"/2015-12-17-backbone-todo-tutorial-part-two/","result":{"data":{"post":{"html":"<h3>Based on <a href=\"http://addyosmani.github.io/backbone-fundamentals/#exercise-1-todos---your-first-backbone.js-app\">Todos - Your First Backbone.js App</a></h3>\n<h4>From the book <a href=\"http://addyosmani.github.io/backbone-fundamentals/\">Developing Backbone.js Applications</a> by <a href=\"https://twitter.com/addyosmani\">Addy Osmani</a></h4>\n<h4>Rationale</h4>\n<p>If you haven't already, take a look at <a href=\"http://unlikenesses.github.io/2015/12/16/backbone-todo-tutorial-part-one/\">part one</a> for info on why this thing exists.</p>\n<h4>1: Storage.</h4>\n<p>Ok, let's get rid of that nasty error:</p>\n<blockquote>\n<p>Uncaught Error: A \"url\" property or function must be specified</p>\n</blockquote>\n<p>Remember that this was being triggered by a couple of <code>save()</code> methods, without our having specified any resource to save to. </p>\n<p>So, let's go back and add that in. First, in <code>index.html</code>, near the bottom, add in a reference to <code>backbone.localStorage.js</code> (you can <a href=\"https://github.com/jeromegn/Backbone.localStorage\">get it from here</a>).</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"assets/js/lib/backbone.localStorage.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></code></pre></div>\n<p>Try it again and you'll see we still get that error. This is because we still need to specify in our Collection that we're overriding the usual Backbone.js <code>sync()</code> method with local storage. This line goes in <code>collections\\todo.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">localStorage<span class=\"token punctuation\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Backbone<span class=\"token punctuation\">.</span>LocalStorage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'todos-backbone'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>(Go back to Addy Osmani's <a href=\"http://addyosmani.com/backbone-fundamentals/#todo-collection\">book</a> if you need to get an overview of what the code looks like in its finished state.)</p>\n<p>Ok, now go back to the browser, refresh the page, add a todo, and at last that error is gone. It's not working perfectly though. Refresh the page again and you'll see that the contents of the list are wiped. What we want is for them to be persisted through page refreshes.</p>\n<h4>2: Recovery</h4>\n<p>To retrieve the stored todos on page refresh, we just need to open up <code>views/app.js</code> and add one line to the end of the <code>initialize()</code> method:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span>Todos<span class=\"token punctuation\">.</span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This simply calls the <code>fetch()</code> method on the Collection. Try refreshing again and you'll see the todos you already entered appear as part of the list when it's initialized.</p>\n<p>Before going on with the rest of the app, it might be worth pausing here to consider what's going on with the local storage part of the code, because it's something that puzzled me on first looking at it.</p>\n<p>As you probably know, <a href=\"https://developer.mozilla.org/en/docs/Web/API/Window/localStorage\">local storage</a> is a way of preserving state between browser sessions, like a cookie on steroids. </p>\n<p>If you recall, previously we received this error on <code>save()</code>:</p>\n<blockquote>\n<p>Uncaught Error: A \"url\" property or function must be specified</p>\n</blockquote>\n<p>This is because <code>save()</code> and <code>fetch()</code> normally expects a URL to be supplied. This URL would point to a data resource (e.g. an API endpoint). Since we're not working with those yet, local storage is the simpler route.</p>\n<h5>3: Completing Todos</h5>\n<p>Open up <code>views/todos.js</code>, we're going to stick pretty closely to the original tutorial here, but I'll break it up into smaller pieces. </p>\n<p>First, we want to add an extra event to the DOM events object:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token string\">'click .toggle'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'togglecompleted'</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>This will simply listen for the <code>.toggle</code> checkbox to be clicked, and call the <code>togglecompleted()</code> method when triggered. So let's add that to the View now:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function-variable function\">togglecompleted</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">toggle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>And as you can see, this calls the Model's <code>toggle()</code> method. So let's open up <code>models/todo.js</code> and add that method (don't forget to add a comma after the <code>defaults</code> object):</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function-variable function\">toggle</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    completed<span class=\"token punctuation\">:</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You might have to look twice at:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">completed<span class=\"token punctuation\">:</span> <span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>To understand this, we need to consult the <a href=\"http://backbonejs.org/#Model-save\">manual entry for the <code>save</code> method</a>: \"The attributes hash (as in set) should contain the attributes you'd like to change â€” keys that aren't mentioned won't be altered\". So for a start, we know here we're only saving the <code>completed</code> key: we're leaving the <code>title</code> key alone. And what are we setting <code>completed</code> to? Well, we're negating (with <code>!</code>) the current value of <code>completed</code> (fetched with <code>this.get()</code>). Which is what a <code>toggle</code> function should do.</p>\n<p>And that's all we need for completing a todo. Try it now - click the checkbox next to a todo item, then refresh the page. It will stay ticked. There is one final cosmetic touch in the book's code, which toggles a <code>completed</code> CSS class on the list item. Add this line to the <code>render()</code> method:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span> <span class=\"token string\">'completed'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now refresh and tick a todo again, and you'll see a line-through is added to it.</p>\n<p>I'd recommend going to the <a href=\"http://addyosmani.com/backbone-fundamentals/#completing-deleting-todos\">relevant section of the original book</a>, if you haven't already, because Osmani gives a great step-by-step explanation of the events that are triggered by clicking the checkbox.</p>\n<h4>4: Deleting / Closing Todos</h4>\n<p>Ok, this is pretty similar to the above, so let's breeze through it. First, add the new event to the DOM events handler in the View:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token string\">'click .destroy'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'clear'</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>As you can see, this calls the <code>clear()</code> method in the View, so let's create that:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function-variable function\">clear</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And this calls the <code>destroy()</code> method in the Model, but in contrast to the <code>toggle()</code> method we created above, we don't need to create a <code>destroy()</code> method, because <a href=\"http://backbonejs.org/#Model-destroy\">it's already built in to the Model</a>. Since this is different from the <code>change</code> trigger, we need to add a new listener to the <code>initialize()</code> method of the View:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'destroy'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This waits for a <code>destroy</code> event to come from the Model, and when it does, calls the View's <code>remove()</code> method, which <a href=\"http://backbonejs.org/#View-remove\">is also built in</a>.</p>\n<h4>5: Mark All as Complete</h4>\n<p>A little detail we've left to near the end: in the <code>index.html</code> file add this to the <code>&#x3C;section></code> with the ID of <code>main</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>checkbox<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>toggle-all<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>toggle-all<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Mark all as complete<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Refresh the page and you'll see this adds an arrow to the left column at the top. We'll want to add a DOM handler to take care of that, and since it occurs at a level <em>above</em> individual todos, we'll need to put that in the root View, so open <code>views/app.js</code>, and add this to the <code>events</code> object:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token string\">'click #toggle-all'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'toggleAllComplete'</span></code></pre></div>\n<p>We'll then need to create the <code>toggleAllComplete()</code> method in the same View:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function-variable function\">toggleAllComplete</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> completed <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>allCheckbox<span class=\"token punctuation\">.</span>checked<span class=\"token punctuation\">;</span>\n\n  app<span class=\"token punctuation\">.</span>Todos<span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span> <span class=\"token parameter\">todo</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    todo<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token string\">'completed'</span><span class=\"token punctuation\">:</span> completed\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This is pretty straightforward: first it gets the boolean value of the \"Mark All\" checkbox (here rendered as an arrow by the CSS). Then it assigns this boolean to each todo in the <code>app.Todos</code> Collection. For this to work, we need to create the variable <code>this.allCheckbox</code>. So add this line to the <code>initialize()</code> method:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>allCheckbox <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#toggle-all'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Try it out: click the \"All Completed\" arrow, and it should toggle the state of all the items in the list. The only problem is that when refreshing the page, although the todos stay in their correct state, the arrow doesn't. So we need to add something to our <code>render()</code> method. First, add the method declaration and these two variables to the beginning:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function-variable function\">render</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> completed <span class=\"token operator\">=</span> app<span class=\"token punctuation\">.</span>Todos<span class=\"token punctuation\">.</span><span class=\"token function\">completed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> remaining <span class=\"token operator\">=</span> app<span class=\"token punctuation\">.</span>Todos<span class=\"token punctuation\">.</span><span class=\"token function\">remaining</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Then, set the state of the checkbox at the end of the <code>render()</code> method:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>allCheckbox<span class=\"token punctuation\">.</span>checked <span class=\"token operator\">=</span> <span class=\"token operator\">!</span>remaining<span class=\"token punctuation\">;</span></code></pre></div>\n<p>You'll have noticed that the two variables <code>completed</code> and <code>remaining</code> depend on methods in the Collection which we haven't yet created, so let's do that now. In <code>collections/todos.js</code>, add:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function-variable function\">completed</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">todo</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> todo<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token function-variable function\">remaining</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">without</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">completed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>The <code>completed()</code> method simply calls Javascript's <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter\">filter</a> method to build an array of todos which have the <code>completed</code> flag set. </p>\n<p>The <code>remaining()</code> method uses the Underscore.js <a href=\"http://underscorejs.org/#without\"><code>without()</code></a> method to return an array of todos <em>without</em> the completed ones.</p>\n<p>With these in place, when you refresh the page the Mark all as Complete checkbox retains its state.</p>\n<h4>6: Statistics</h4>\n<p>You'll have noticed I've left out the statistics and filters. We'll turn to these now.</p>\n<p>First, add the <code>&#x3C;footer></code> tag right after the <code>&#x3C;section></code> with the <code>id</code> of <code>main</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>footer</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>footer<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>footer</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>then add the stats template right after the item template:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/template<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stats-template<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token operator\">&lt;</span>span id<span class=\"token operator\">=</span><span class=\"token string\">\"todo-count\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>strong<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">%=</span> remaining <span class=\"token operator\">%</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>strong<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">%=</span> remaining <span class=\"token operator\">===</span> <span class=\"token number\">1</span> <span class=\"token operator\">?</span> <span class=\"token string\">'item'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'items'</span> <span class=\"token operator\">%</span><span class=\"token operator\">></span> left<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>ul id<span class=\"token operator\">=</span><span class=\"token string\">\"filters\"</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>a href<span class=\"token operator\">=</span><span class=\"token string\">\"#/\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"selected\"</span><span class=\"token operator\">></span>All<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>a href<span class=\"token operator\">=</span><span class=\"token string\">\"#/active\"</span><span class=\"token operator\">></span>Active<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>li<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>a href<span class=\"token operator\">=</span><span class=\"token string\">\"#/completed\"</span><span class=\"token operator\">></span>Completed<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>completed<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">%</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>button id<span class=\"token operator\">=</span><span class=\"token string\">\"clear-completed\"</span><span class=\"token operator\">></span>Clear <span class=\"token function\">completed</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">%=</span> completed <span class=\"token operator\">%</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">%</span><span class=\"token operator\">></span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>This code is all pretty self-explanatory. But we need to add some functionality, so go back to <code>views/app.js</code>, and define the <code>template</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">statsTemplate<span class=\"token punctuation\">:</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">template</span><span class=\"token punctuation\">(</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#stats-template'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>This works exactly the same as the <code>_.template()</code> method in <code>views/todos.js</code>. In the <code>initialize()</code> method we also want to instantiate a <code>footer</code> variable to grab the footer element:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$footer <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#footer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Finally, we have to render the footer. Add this code in the <code>render()</code> method:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> app<span class=\"token punctuation\">.</span>Todos<span class=\"token punctuation\">.</span>length <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$main<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$footer<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$footer<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">statsTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    completed<span class=\"token punctuation\">:</span> completed<span class=\"token punctuation\">,</span>\n    remaining<span class=\"token punctuation\">:</span> remaining\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#filters li a'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">removeClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'selected'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[href=\"#/'</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span> app<span class=\"token punctuation\">.</span>TodoFilter <span class=\"token operator\">||</span> <span class=\"token string\">''</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'\"]'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">addClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'selected'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$main<span class=\"token punctuation\">.</span><span class=\"token function\">hide</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$footer<span class=\"token punctuation\">.</span><span class=\"token function\">hide</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This logic shows or hides certain parts of the GUI depending on whether or not there are any todos in the Collection. If not, the footer and the Mark all as Complete button (in the <code>main</code> section) are hidden. If there <em>are</em> todos, it shows the main and footer sections, fills the footer template with the <code>completed</code> and <code>remaining</code> variables already created in this method, and performs a bit of jQuery magic to highlight the appropriate filter (All, Active or Completed) depending on what the URL is (we will come to this in the next section).</p>\n<p>Now if you look in the stats template, you'll see a button with the <code>id</code> of <code>clear-completed</code>. So let's add that functionality. First, add the event to the DOM handler:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token string\">'click #clear-completed'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'clearCompleted'</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>then create the <code>clearCompleted()</code> method:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function-variable function\">clearCompleted</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  _<span class=\"token punctuation\">.</span><span class=\"token function\">invoke</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>Todos<span class=\"token punctuation\">.</span><span class=\"token function\">completed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'destroy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>This uses the Underscore.js <a href=\"http://underscorejs.org/#invoke\"><code>invoke()</code></a> method to call <code>destroy</code> on all completed todos in the <code>app.Todos</code> Collection.</p>\n<h4>7: The Router and Filtering</h4>\n<p>Lastly, let's get the filters working. First, add the reference to the router in <code>index.html</code>:</p>\n<p><code>&#x3C;script src=\"assets/js/routers/router.js\">&#x3C;/script></code></p>\n<p><a href=\"http://addyosmani.com/backbone-fundamentals/#todo-routing\">As Osmani says</a>, the following routes will be needed:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#/ (all - default)\n#/active\n#/completed</code></pre></div>\n<p>Then, create the file (<code>routers/router.js</code>). This is copied verbatim from the tutorial:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> app <span class=\"token operator\">=</span> app <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> Workspace <span class=\"token operator\">=</span> Backbone<span class=\"token punctuation\">.</span>Router<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  routes<span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'*filter'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'setFilter'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token function-variable function\">setFilter</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span> <span class=\"token parameter\">param</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Set the current filter to be used</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      param <span class=\"token operator\">=</span> param<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    app<span class=\"token punctuation\">.</span>TodoFilter <span class=\"token operator\">=</span> param <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Trigger a collection filter event, causing hiding/unhiding</span>\n    <span class=\"token comment\">// of Todo view items</span>\n    app<span class=\"token punctuation\">.</span>Todos<span class=\"token punctuation\">.</span><span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token string\">'filter'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span>TodoRouter <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Workspace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nBackbone<span class=\"token punctuation\">.</span>history<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Let's take a quick tour of this file. Notice it sets up a <code>routes</code> object. If we look at the <a href=\"http://backbonejs.org/#Router-routes\">manual</a> we'll see that this maps a series of routes to a series of functions. In our case we're using a wildcard, or a <code>*splat</code> part, for the whole path; in other words, any path will be matched by this and passed to the <code>setFilter()</code> method. We want the URL to specify what kind of filter is being applied to the todo list - display all, active or completed.</p>\n<p>The <code>setFilter()</code> method trims the URL parameter (if it exists), sets the <code>app.TodoFilter</code> variable to it, and triggers a <code>filter</code> event on the Collection <code>app.Todos</code>. </p>\n<p>This event makes no difference to the collection - it only affects what we can see. So it makes sense that Osmani puts the code for this in the main App View. Open up <code>views/app.js</code> and add two new event listeners to the <code>initialize()</code> method:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>Todos<span class=\"token punctuation\">,</span> <span class=\"token string\">'change:completed'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>filterOne<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>Todos<span class=\"token punctuation\">,</span> <span class=\"token string\">'filter'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>filterAll<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>and add the two methods:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function-variable function\">filterOne</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">todo</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  todo<span class=\"token punctuation\">.</span><span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token string\">'visible'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token function-variable function\">filterAll</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  app<span class=\"token punctuation\">.</span>Todos<span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>filterOne<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>These trigger an event called <code>visible</code> which is listened to by the individual todo view. So let's create that listener. Open <code>views/todos.js</code>, and add the listener to its <code>initialize()</code> method:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">listenTo</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">,</span> <span class=\"token string\">'visible'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>toggleVisible<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We then create the <code>toggleVisible()</code> method:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function-variable function\">toggleVisible</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$el<span class=\"token punctuation\">.</span><span class=\"token function\">toggleClass</span><span class=\"token punctuation\">(</span> <span class=\"token string\">'hidden'</span><span class=\"token punctuation\">,</span>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isHidden</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>This calls the jQuery <code>toggleClass()</code> method, passing it another new method, <code>isHidden()</code> as the boolean test:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function-variable function\">isHidden</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> isCompleted <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>model<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span> <span class=\"token comment\">// hidden cases only</span>\n    <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isCompleted <span class=\"token operator\">&amp;&amp;</span> app<span class=\"token punctuation\">.</span>TodoFilter <span class=\"token operator\">===</span> <span class=\"token string\">'completed'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>isCompleted <span class=\"token operator\">&amp;&amp;</span> app<span class=\"token punctuation\">.</span>TodoFilter <span class=\"token operator\">===</span> <span class=\"token string\">'active'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>This returns <code>TRUE</code> if the filter is set to <code>completed</code> (i.e. if the URL is <code>#/completed</code>) and this todo is not completed, or if the filter is <code>active</code> (the URL is <code>#/active</code>) and the todo <em>is</em> completed. In either of these cases, it returns <code>TRUE</code>, i.e. this todo is hidden. </p>\n<p>That's all you need for the filtering. Refresh the page and you'll see the filters at the bottom hiding todos depending on their state. </p>\n<p>There's a couple of other things in Osmani's tutorial which I haven't had time to go into here, but hopefully this has given you enough of a clue to figure them out. As I said, I think it's a great tutorial, but breaking it down into these smaller blocks really helped me to understand Backbone at these early stages.</p>","fields":{"title":"backbone todo tutorial part two","date":"17 December, 2015","url":"http://unlikenesses.com/2015-12-17-backbone-todo-tutorial-part-two/"}}},"pageContext":{"slug":"/2015-12-17-backbone-todo-tutorial-part-two/","prev":{"fields":{"title":"backbone todo tutorial part one","date":"16 December, 2015","slug":"/2015-12-16-backbone-todo-tutorial-part-one/"}},"next":{"fields":{"title":"mp info","date":"20 February, 2016","slug":"/2016-02-20-mp-info/"}}}}}