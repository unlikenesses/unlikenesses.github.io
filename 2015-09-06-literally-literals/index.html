<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.c80581122dc77a5cdbb4.css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}

/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}a{background-color:transparent}small{font-size:80%}h1,p{margin:0}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e2e8f0}h1{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}.bg-white{--bg-opacity:1;background-color:#fff;background-color:rgba(255,255,255,var(--bg-opacity))}.bg-gray-300{--bg-opacity:1;background-color:#e2e8f0;background-color:rgba(226,232,240,var(--bg-opacity))}.hover\:bg-gray-400:hover{--bg-opacity:1;background-color:#cbd5e0;background-color:rgba(203,213,224,var(--bg-opacity))}.rounded{border-radius:.25rem}.flex{display:flex}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-between{justify-content:space-between}.font-bold{font-weight:700}.text-sm{font-size:.875rem}.text-lg{font-size:1.125rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem}.text-4xl{font-size:2.25rem}.text-5xl{font-size:3rem}.my-4{margin-top:1rem;margin-bottom:1rem}.mx-auto{margin-left:auto;margin-right:auto}.mr-3{margin-right:.75rem}.p-6{padding:1.5rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.px-4{padding-left:1rem;padding-right:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.pt-2{padding-top:.5rem}.pb-3{padding-bottom:.75rem}.pl-3{padding-left:.75rem}.pb-5{padding-bottom:1.25rem}.pt-6{padding-top:1.5rem}.pb-6{padding-bottom:1.5rem}.pb-8{padding-bottom:2rem}.shadow{box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06)}.hover\:shadow-md:hover{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.text-left{text-align:left}.text-gray-600{--text-opacity:1;color:#718096;color:rgba(113,128,150,var(--text-opacity))}.text-gray-700{--text-opacity:1;color:#4a5568;color:rgba(74,85,104,var(--text-opacity))}.text-pink-600{--text-opacity:1;color:#d53f8c;color:rgba(213,63,140,var(--text-opacity))}.hover\:text-gray-700:hover{--text-opacity:1;color:#4a5568;color:rgba(74,85,104,var(--text-opacity))}.hover\:text-pink-600:hover{--text-opacity:1;color:#d53f8c;color:rgba(213,63,140,var(--text-opacity))}.uppercase{text-transform:uppercase}.capitalize{text-transform:capitalize}.no-underline{text-decoration:none}.hover\:underline:hover{text-decoration:underline}.w-1\/2{width:50%}.w-2\/3{width:66.666667%}.w-full{width:100%}.nunito{font-family:Nunito,sans-serif}p{line-height:2}h2,p{margin-bottom:1.5rem}h2{font-size:1.5rem;margin-top:.5rem}h2,h3{font-weight:700}h3{font-size:1.25rem;margin-top:1rem;margin-bottom:1.25rem}h4{font-size:1.125rem;font-weight:700}code{--text-opacity:1;color:#ed64a6;color:rgba(237,100,166,var(--text-opacity));--bg-opacity:1;background-color:#fff5f7;background-color:rgba(255,245,247,var(--bg-opacity));border-radius:.375rem;padding:.25rem .5rem}pre code{padding-left:0;padding-right:0}a{color:#ed64a6;color:rgba(237,100,166,var(--text-opacity));text-decoration:underline}a,blockquote{--text-opacity:1}blockquote{--border-opacity:1;border-color:#ed64a6;border-color:rgba(237,100,166,var(--border-opacity));border-left-width:4px;padding-left:1rem;margin-bottom:.75rem;color:#4a5568;color:rgba(74,85,104,var(--text-opacity))}ul{list-style-type:disc;margin-bottom:.5rem}ol,ul{list-style-position:inside}ol{list-style-type:decimal}</style><meta name="generator" content="Gatsby 2.18.17"/><title data-react-helmet="true">Unlikenesses</title><meta data-react-helmet="true" name="description" content="A PHP Developer"/><link href="https://fonts.googleapis.com/css?family=Nunito:400,700" rel="stylesheet"/><link as="script" rel="preload" href="/styles-9a353c6f1161ef8c88fb.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-31d5885bc3a738a8d113.js"/><link as="script" rel="preload" href="/commons-a98b242466aa29e9f3f5.js"/><link as="script" rel="preload" href="/app-3d34126c26312025b100.js"/><link as="script" rel="preload" href="/webpack-runtime-442c371bc34315c411cc.js"/><link as="fetch" rel="preload" href="/page-data\2015-09-06-literally-literals\page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="nunito"><div class="container w-2/3 mx-auto flex flex-wrap py-6"><header class="pl-3 pb-6"><a class="font-bold text-gray-700 uppercase hover:text-gray-700 text-5xl no-underline" href="/">Unlikenesses <span class="text-xl">A PHP Developer</span></a><nav><a class="no-underline mr-3 text-gray-600 hover:text-pink-600" href="https://twitter.com/unlikenesses" target="_blank" rel="noopener noreferrer">Twitter</a><a class="no-underline mr-3 text-gray-600 hover:text-pink-600" href="https://github.com/unlikenesses" target="_blank" rel="noopener noreferrer">GitHub</a><a class="no-underline text-gray-600 hover:text-pink-600" href="http://codepen.io/unlikenesses/" target="_blank" rel="noopener noreferrer">CodePen</a></nav></header><section class="w-full flex flex-col items-center px-3"><article class="w-full flex flex-col my-4"><div class="bg-white flex flex-col justify-start py-6"><h1 class="text-4xl font-bold text-gray-700 capitalize">Object Literals</h1><span class="text-sm pb-8 text-gray-600">06 September, 2015</span><div class="text-gray-700 text-lg"><p>So I'm taking a break from Laravel to continue to brush up my Javascript skills, and I thought a small Chrome extension would be ideal. It's pretty embryonic for now, but basically it involves highlighting certain words on a page and calling an API to find more info related to those words, then displaying a tooltip containing this info when the user hovers over them.</p>
<p>I got the extension working ok, but it was a tangled mess of code. So it was time to refactor. I decided at first to try the object literal pattern. At first I wanted to convert the <code>event.js</code> file into this notation. I quickly discovered the benefits: what was before an unreadable trail of spaghetti became a neatly demarcated set of functions whose names made the overall intent of the code easy to ascertain at a glance. In the <code>init</code> method I placed my listener:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function-variable function">init</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> sendResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>fn <span class="token keyword">in</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            event<span class="token punctuation">[</span>request<span class="token punctuation">.</span>fn<span class="token punctuation">]</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>sender<span class="token punctuation">,</span>sendResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>Basically, the listener is sent as part of its <code>request</code> object a function name -- if this function is in the <code>event</code> object then it's called. So in my <code>content.js</code> file I would send a message to <code>event.js</code> with a <code>request</code> object containing the property <code>fn</code>.</p>
<p>This worked fine, but there was a new problem now that I had modularised the event script. I had a main method (let's call it <code>getDetails</code>): this was the function I passed as <code>fn</code>, and hence the method that would get called by the listener.</p>
<p>This method, <code>getDetails</code>, would then call two more methods, to make two different calls to an API. Each of these would return an object, and <code>getDetails</code> would put these two objects into a container object, and send it back with <code>sendResponse()</code>.</p>
<p>I'm using jquery's <code>$.ajax</code> to make the API calls. Now, before I modularised this script, I would use <code>.then</code> to store the result, make <em>another</em> <code>$.ajax</code> call to the next API endpoint, and in <em>that</em> call's <code>.then</code> finally call <code>sendResponse()</code>. </p>
<p>But after modularising this script, these chained (or rather embedded) <code>$.ajax</code> calls were split into two methods (say, <code>getDetailsA</code> and <code>getDetailsB</code>), from which I had to return the result of the API calls. And the problem is that a function can't return data from an asychronous call, and synchronous calls (as Chrome's console told me) are now deprecated. </p>
<p>So, after some googling, came callbacks to the rescue. I added an argument <code>callback</code> to each of the API methods (<code>getDetailsA</code> and <code>getDetailsB</code>). In those methods, after the <code>$.ajax</code> call is made, in the <code>.then</code> section instead of <code>return data</code>, I have <code>callback(data)</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function-variable function">getDetailsA</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        url<span class="token punctuation">:</span> request<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
        dataType<span class="token punctuation">:</span> <span class="token string">'json'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// return data;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xhr<span class="token punctuation">,</span>status<span class="token punctuation">,</span>error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Then, when I call this method in <code>getDetails</code>, I pass as a second argument a closure that does what I want to do with the data. In this case, what I want to do with the data, is first add it to the container object, then call another method (<code>getDetailsB</code>), add the result of that to the same container object, then send it back with <code>sendResponse()</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function-variable function">getDetails</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>sender<span class="token punctuation">,</span>sendResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> returnObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    that<span class="token punctuation">.</span><span class="token function">getDetailsA</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        returnObj<span class="token punctuation">[</span><span class="token string">'detailsA'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">;</span> 
        that<span class="token punctuation">.</span><span class="token function">getDetailsB</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            returnObj<span class="token punctuation">[</span><span class="token string">'detailsB'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>
            <span class="token function">sendResponse</span><span class="token punctuation">(</span>returnObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>Small projects like this are great for getting your head around little gotchas which you read about in tutorials and manuals, but which until you actually build something remain pretty abstract. One example is the use of callbacks in ajax functions; another was the scope of <code>this</code> and its vicissitudes. Although I already knew about it, I hadn't had a chance to see this issue in action, and was pleased that I knew what to do after seeing the error caused by at first having <code>this.getDetailsB</code> in the above snippet. I fixed it with a simple <code>var that = this</code>, and all was well. </p>
<p><strong>Update</strong></p>
<p>The final Chrome extension is viewable <a href="https://github.com/unlikenesses/mp-info">here</a>.</p></div></div></article><div class="w-full flex pt-6"><a class="w-1/2 bg-white shadow hover:shadow-md text-left p-6 no-underline" href="/2015-08-17-glossy/"><p class="text-lg text-gray-700 font-bold flex items-center">Previous<!-- -->:</p><p class="pt-2 capitalize">glossy<!-- --> <small>17 August, 2015</small></p></a><a class="w-1/2 bg-white shadow hover:shadow-md text-left p-6 no-underline" href="/2015-10-09-soft-cascading/"><p class="text-lg text-gray-700 font-bold flex items-center">Next<!-- -->:</p><p class="pt-2 capitalize">soft cascading<!-- --> <small>09 October, 2015</small></p></a></div></section></div><footer class="container w-2/3 mx-auto flex flex-wrap py-4 px-5 justify-between text-gray-600"><p>Unlikenesses</p><p>Built with <a href="https://www.gatsbyjs.org" target="_blank">GatsbyJS</a> and <a href="https://tailwindcss.com" target="_blank">Tailwind CSS</a></p></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2015-09-06-literally-literals/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-3d34126c26312025b100.js"],"component---src-templates-index-js":["/component---src-templates-index-js-ef7da5a2960572cc5911.js"],"component---src-templates-post-js":["/component---src-templates-post-js-31d5885bc3a738a8d113.js"],"component---src-pages-404-js":["/component---src-pages-404-js-224a4a61ab9775ba900d.js"]};/*]]>*/</script><script src="/webpack-runtime-442c371bc34315c411cc.js" async=""></script><script src="/app-3d34126c26312025b100.js" async=""></script><script src="/commons-a98b242466aa29e9f3f5.js" async=""></script><script src="/component---src-templates-post-js-31d5885bc3a738a8d113.js" async=""></script><script src="/styles-9a353c6f1161ef8c88fb.js" async=""></script></body></html>