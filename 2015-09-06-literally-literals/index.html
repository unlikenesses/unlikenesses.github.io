<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/commons.3e58207322efed7d1fc2.css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}*{box-sizing:border-box}body,html{margin:0;padding:0}html{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5}@media (min-width:38em){html{font-size:20px}}body{color:#515151;background-color:#fff;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}a{color:#268bd2;text-decoration:none}a strong{color:inherit}a:focus,a:hover{text-decoration:underline}h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:700;line-height:1.25;color:#313131;text-rendering:optimizeLegibility}h1{font-size:2rem}h2{margin-top:1rem;font-size:1.5rem}h3{margin-top:1.5rem;font-size:1.25rem}h4,h5,h6{margin-top:1rem;font-size:1rem}p{margin-top:0;margin-bottom:1rem}strong{color:#303030}dl,ol,ul{margin-top:0;margin-bottom:1rem}dt{font-weight:700}dd{margin-bottom:.5rem}hr{position:relative;margin:1.5rem 0;border:0;border-top:1px solid #eee;border-bottom:1px solid #fff}abbr{font-size:85%;font-weight:700;color:#555;text-transform:uppercase}abbr[title]{cursor:help;border-bottom:1px dotted #e5e5e5}code,pre{font-family:Menlo,Monaco,Courier New,monospace}code{padding:.25em .5em;font-size:85%;color:#bf616a;border-radius:3px}code,pre{background-color:#f9f9f9}pre{display:block;margin-top:0;margin-bottom:1rem;padding:1rem;font-size:.8rem;line-height:1.4;white-space:pre;white-space:pre-wrap;word-break:break-all;word-wrap:break-word}pre code{padding:0;font-size:100%;color:inherit;background-color:transparent}.highlight{margin-bottom:1rem;border-radius:4px}.highlight pre{margin-bottom:0}.gist .gist-file{font-family:Menlo,Monaco,Courier New,monospace!important}.gist .markdown-body{padding:15px}.gist pre{padding:0;background-color:transparent}.gist .gist-file .gist-data{font-size:.8rem!important;line-height:1.4}.gist code{padding:0;color:inherit;background-color:transparent;border-radius:0}blockquote{padding:.5rem 1rem;margin:.8rem 0;color:#7a7a7a;border-left:.25rem solid #e5e5e5}blockquote p:last-child{margin-bottom:0}@media (min-width:30em){blockquote{padding-right:5rem;padding-left:1.25rem}}img{display:block;max-width:100%;margin:0 0 1rem;border-radius:5px}table{margin-bottom:1rem;width:100%;border:1px solid #e5e5e5;border-collapse:collapse}td,th{padding:.25rem .5rem;border:1px solid #e5e5e5}tbody tr:nth-child(odd) td,tbody tr:nth-child(odd) th{background-color:#f9f9f9}.lead{font-size:1.25rem;font-weight:300}.message{margin-bottom:1rem;padding:1rem;color:#717171;background-color:#f9f9f9}.container{max-width:38rem;padding-left:1rem;padding-right:1rem;margin-left:auto;margin-right:auto}.masthead{padding-top:1rem;padding-bottom:1rem;margin-bottom:3rem}.masthead-title{margin-top:0;margin-bottom:0;color:#505050}.masthead-title a{color:#505050}.masthead-title small{font-size:75%;font-weight:400;color:silver;letter-spacing:0}.page,.post{margin-bottom:4em}.page-title,.post-title,.post-title a{color:#303030}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-.5rem;margin-bottom:1rem;color:#9a9a9a}.related{padding-top:2rem;padding-bottom:2rem;border-top:1px solid #eee}.related-posts{padding-left:0;list-style:none}.related-posts h3{margin-top:0}.related-posts li small{font-size:75%;color:#999}.related-posts li a:hover{color:#268bd2;text-decoration:none}.related-posts li a:hover small{color:inherit}.pagination{overflow:hidden;margin-left:-1rem;margin-right:-1rem;font-family:PT Sans,Helvetica,Arial,sans-serif;color:#ccc;text-align:center}.pagination-item{display:block;padding:1rem;border:1px solid #eee}.pagination-item:first-child{margin-bottom:-1px}a.pagination-item:hover{background-color:#f5f5f5}@media (min-width:30em){.pagination{margin:3rem 0}.pagination-item{float:left;width:50%}.pagination-item:first-child{margin-bottom:0;border-top-left-radius:4px;border-bottom-left-radius:4px}.pagination-item:last-child{margin-left:-1px;border-top-right-radius:4px;border-bottom-right-radius:4px}}html{font-family:"Noto Serif",Georgia,serif}@media (min-width:48em){html{font-size:16px}}@media (min-width:58em){html{font-size:17px;line-height:1.75}}.sidebar{font-family:Roboto Slab,Helvetica,Arial,sans-serif;text-align:center;padding:2rem 1rem;color:hsla(0,0%,100%,.5);background-color:#202020}@media (min-width:48em){.sidebar{position:fixed;top:0;left:0;bottom:0;width:18rem;text-align:left}}.sidebar a{color:#fff}.sidebar-about h1{color:#fff;margin-top:0;font-size:2.25rem}.sidebar-nav{margin-bottom:1rem}.sidebar-nav-item{display:block;line-height:1.75}a.sidebar-nav-item:focus,a.sidebar-nav-item:hover{text-decoration:underline}.sidebar-nav-item.active{font-weight:700}@media (min-width:48em){.sidebar-sticky{position:absolute;right:1rem;bottom:1rem;left:1rem}}.content{padding-top:4rem;padding-bottom:4rem}@media (min-width:48em){.content{max-width:38rem;margin-left:20rem;margin-right:2rem}}@media (min-width:64em){.content{margin-left:22rem;margin-right:4rem}}@media (min-width:48em){.layout-reverse .sidebar{left:auto;right:0}.layout-reverse .content{margin-left:2rem;margin-right:20rem}}@media (min-width:64em){.layout-reverse .content{margin-left:4rem;margin-right:22rem}}.page-title,.post-title,h2,h3,h4{font-family:Roboto Slab,Helvetica,Arial,sans-serif;text-transform:capitalize}.post-title{font-size:2rem}.theme-base-08 .sidebar{background-color:#ac4142}.theme-base-08 .content a,.theme-base-08 .related-posts li a:hover{color:#ac4142}.theme-base-09 .sidebar{background-color:#d28445}.theme-base-09 .content a,.theme-base-09 .related-posts li a:hover{color:#d28445}.theme-base-0a .sidebar{background-color:#f4bf75}.theme-base-0a .content a,.theme-base-0a .related-posts li a:hover{color:#f4bf75}.theme-base-0b .sidebar{background-color:#90a959}.theme-base-0b .content a,.theme-base-0b .related-posts li a:hover{color:#90a959}.theme-base-0c .sidebar{background-color:#75b5aa}.theme-base-0c .content a,.theme-base-0c .related-posts li a:hover{color:#75b5aa}.theme-base-0d .sidebar{background-color:#6a9fb5}.theme-base-0d .content a,.theme-base-0d .related-posts li a:hover{color:#6a9fb5}.theme-base-0e .sidebar{background-color:#aa759f}.theme-base-0e .content a,.theme-base-0e .related-posts li a:hover{color:#aa759f}.theme-base-0f .sidebar{background-color:#8f5536}.theme-base-0f .content a,.theme-base-0f .related-posts li a:hover{color:#8f5536}#mc_embed_signup form{display:block;position:relative;text-align:left;padding:10px 0 10px 3%}#mc_embed_signup h2{font-weight:700;padding:0;margin:15px 0;font-size:1.4em}#mc_embed_signup input{border:1px solid #999;-webkit-appearance:none}#mc_embed_signup input[type=checkbox]{-webkit-appearance:checkbox}#mc_embed_signup input[type=radio]{-webkit-appearance:radio}#mc_embed_signup input:focus{border-color:#333}#mc_embed_signup .button{clear:both;background-color:#aaa;border:0;border-radius:4px;letter-spacing:.03em;color:#fff;cursor:pointer;display:inline-block;font-size:15px;height:32px;line-height:32px;margin:0 5px 10px 0;padding:0;text-align:center;text-decoration:none;vertical-align:top;white-space:nowrap;width:auto;-webkit-transition:all .23s ease-in-out 0s;transition:all .23s ease-in-out 0s}#mc_embed_signup .button:hover{background-color:#777}#mc_embed_signup .small-meta{font-size:11px}#mc_embed_signup .nowrap{white-space:nowrap}#mc_embed_signup .clear{clear:none;display:inline}#mc_embed_signup label{display:block;font-size:16px;padding-bottom:10px;font-weight:700}#mc_embed_signup input.email{font-family:Open Sans,Helvetica Neue,Arial,Helvetica,Verdana,sans-serif;font-size:15px;display:block;padding:0 .4em;margin:0 4% 10px 0;min-height:32px;width:58%;min-width:130px;border-radius:3px}#mc_embed_signup input.button{display:block;width:35%;margin:0 0 10px;min-width:90px}#mc_embed_signup div#mce-responses{float:left;top:-1.4em;padding:0 .5em;overflow:hidden;width:90%;margin:0 5%;clear:both}#mc_embed_signup div.response{margin:1em 0;padding:1em .5em .5em 0;font-weight:700;float:left;top:-1.5em;z-index:1;width:80%}#mc_embed_signup #mce-error-response{display:none}#mc_embed_signup #mce-success-response{color:#529214;display:none}#mc_embed_signup label.error{display:block;float:none;width:auto;margin-left:1.05em;text-align:left;padding:.5em 0}#mc_embed_signup{clear:left;font-size:14px}#mc_embed_signup input{border:1px solid hsla(0,0%,100%,.5)}#mc_embed_signup input.email{width:100%;font-family:Roboto Slab,Helvetica,Arial,sans-serif}#mc_embed_signup form{padding-left:0}#mc_embed_signup input.button{width:50%}#mc_embed_signup .button{background-color:hsla(0,0%,100%,.5);font-family:Roboto Slab,Helvetica,Arial,sans-serif;color:#ac4142}#mc_embed_signup .button:hover{background-color:#fff}code[class*=language-],pre[class*=language-]{font-family:Menlo,Monaco,Courier New,monospace;font-size:14px}</style><meta name="generator" content="Gatsby 2.15.36"/><link href="https://fonts.googleapis.com/css?family=Roboto+Slab:700|Noto+Serif:400,400i,700,700i" rel="stylesheet"/><link as="script" rel="preload" href="/app-6c5db7e46a2680e5b256.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-4505edc6c7cc65e9d77e.js"/><link as="script" rel="preload" href="/commons-a57d59762ae473d00a00.js"/><link as="script" rel="preload" href="/webpack-runtime-85745c3f6b306aa14381.js"/><link as="fetch" rel="preload" href="/page-data/2015-09-06-literally-literals/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="theme-base-08"><div class="sidebar"><div class="container sidebar-sticky"><div class="sidebar-about"><h1><a href="/">Unlikenesses</a></h1><p class="lead"></p></div><nav class="sidebar-nav"><a class="sidebar-nav-item" href="/">Blog</a><a class="sidebar-nav-item" href="/about/">About</a><a class="sidebar-nav-item" href="/experiments/">Experiments</a><a class="sidebar-nav-item" href="https://twitter.com/unlikenesses" target="_blank" rel="noopener noreferrer">Twitter</a><a class="sidebar-nav-item" href="https://github.com/unlikenesses" target="_blank" rel="noopener noreferrer">Github</a><a class="sidebar-nav-item" href="http://codepen.io/unlikenesses/" target="_blank" rel="noopener noreferrer">Codepen</a></nav><div><a class="twitter-follow-button" href="https://twitter.com/unlikenesses" target="_blank" rel="noopener noreferrer">Follow @unlikenesses</a></div><p>© <!-- -->2019</p></div></div><div class="content container"><div class="post"><h1 class="post-title">literally literals</h1><span class="post-date">06 September, 2015</span><div><p>So I'm taking a break from Laravel to continue to brush up my Javascript skills, and I thought a small Chrome extension would be ideal. It's pretty embryonic for now, but basically it involves highlighting certain words on a page and calling an API to find more info related to those words, then displaying a tooltip containing this info when the user hovers over them.</p>
<p>I got the extension working ok, but it was a tangled mess of code. So it was time to refactor. I decided at first to try the object literal pattern. At first I wanted to convert the <code>event.js</code> file into this notation. I quickly discovered the benefits: what was before an unreadable trail of spaghetti became a neatly demarcated set of functions whose names made the overall intent of the code easy to ascertain at a glance. In the <code>init</code> method I placed my listener:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function-variable function">init</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> sendResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>fn <span class="token keyword">in</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            event<span class="token punctuation">[</span>request<span class="token punctuation">.</span>fn<span class="token punctuation">]</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>sender<span class="token punctuation">,</span>sendResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>Basically, the listener is sent as part of its <code>request</code> object a function name -- if this function is in the <code>event</code> object then it's called. So in my <code>content.js</code> file I would send a message to <code>event.js</code> with a <code>request</code> object containing the property <code>fn</code>.</p>
<p>This worked fine, but there was a new problem now that I had modularised the event script. I had a main method (let's call it <code>getDetails</code>): this was the function I passed as <code>fn</code>, and hence the method that would get called by the listener.</p>
<p>This method, <code>getDetails</code>, would then call two more methods, to make two different calls to an API. Each of these would return an object, and <code>getDetails</code> would put these two objects into a container object, and send it back with <code>sendResponse()</code>.</p>
<p>I'm using jquery's <code>$.ajax</code> to make the API calls. Now, before I modularised this script, I would use <code>.then</code> to store the result, make <em>another</em> <code>$.ajax</code> call to the next API endpoint, and in <em>that</em> call's <code>.then</code> finally call <code>sendResponse()</code>. </p>
<p>But after modularising this script, these chained (or rather embedded) <code>$.ajax</code> calls were split into two methods (say, <code>getDetailsA</code> and <code>getDetailsB</code>), from which I had to return the result of the API calls. And the problem is that a function can't return data from an asychronous call, and synchronous calls (as Chrome's console told me) are now deprecated. </p>
<p>So, after some googling, came callbacks to the rescue. I added an argument <code>callback</code> to each of the API methods (<code>getDetailsA</code> and <code>getDetailsB</code>). In those methods, after the <code>$.ajax</code> call is made, in the <code>.then</code> section instead of <code>return data</code>, I have <code>callback(data)</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function-variable function">getDetailsA</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        url<span class="token punctuation">:</span> request<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
        type<span class="token punctuation">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
        dataType<span class="token punctuation">:</span> <span class="token string">'json'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// return data;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xhr<span class="token punctuation">,</span>status<span class="token punctuation">,</span>error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Then, when I call this method in <code>getDetails</code>, I pass as a second argument a closure that does what I want to do with the data. In this case, what I want to do with the data, is first add it to the container object, then call another method (<code>getDetailsB</code>), add the result of that to the same container object, then send it back with <code>sendResponse()</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function-variable function">getDetails</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span>sender<span class="token punctuation">,</span>sendResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> returnObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    that<span class="token punctuation">.</span><span class="token function">getDetailsA</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        returnObj<span class="token punctuation">[</span><span class="token string">'detailsA'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">;</span> 
        that<span class="token punctuation">.</span><span class="token function">getDetailsB</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            returnObj<span class="token punctuation">[</span><span class="token string">'detailsB'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>
            <span class="token function">sendResponse</span><span class="token punctuation">(</span>returnObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>Small projects like this are great for getting your head around little gotchas which you read about in tutorials and manuals, but which until you actually build something remain pretty abstract. One example is the use of callbacks in ajax functions; another was the scope of <code>this</code> and its vicissitudes. Although I already knew about it, I hadn't had a chance to see this issue in action, and was pleased that I knew what to do after seeing the error caused by at first having <code>this.getDetailsB</code> in the above snippet. I fixed it with a simple <code>var that = this</code>, and all was well. </p>
<p><strong>Update</strong></p>
<p>The final Chrome extension is viewable <a href="https://github.com/unlikenesses/mp-info">here</a>.</p></div></div><div class="related"><ul class="related-posts"><li><h3>Previous<!-- -->:<!-- --> <a href="/2015-08-17-glossy/">glossy<!-- --> <small>17 August, 2015</small></a></h3></li><li><h3>Next<!-- -->:<!-- --> <a href="/2015-10-09-soft-cascading/">soft cascading<!-- --> <small>09 October, 2015</small></a></h3></li></ul></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2015-09-06-literally-literals/";window.webpackCompilationHash="953b0c83299123db49b0";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-6c5db7e46a2680e5b256.js"],"component---src-templates-index-js":["/component---src-templates-index-js-37ce12bb80a9f7262bef.js"],"component---src-templates-post-js":["/component---src-templates-post-js-4505edc6c7cc65e9d77e.js"],"component---src-templates-page-js":["/component---src-templates-page-js-dd9a065be189ea504205.js"],"component---src-pages-404-js":["/component---src-pages-404-js-7ef4343af97b4bd9bf54.js"]};/*]]>*/</script><script src="/webpack-runtime-85745c3f6b306aa14381.js" async=""></script><script src="/commons-a57d59762ae473d00a00.js" async=""></script><script src="/component---src-templates-post-js-4505edc6c7cc65e9d77e.js" async=""></script><script src="/app-6c5db7e46a2680e5b256.js" async=""></script></body></html>