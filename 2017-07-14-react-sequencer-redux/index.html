<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/commons.3e58207322efed7d1fc2.css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}*{box-sizing:border-box}body,html{margin:0;padding:0}html{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5}@media (min-width:38em){html{font-size:20px}}body{color:#515151;background-color:#fff;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}a{color:#268bd2;text-decoration:none}a strong{color:inherit}a:focus,a:hover{text-decoration:underline}h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:700;line-height:1.25;color:#313131;text-rendering:optimizeLegibility}h1{font-size:2rem}h2{margin-top:1rem;font-size:1.5rem}h3{margin-top:1.5rem;font-size:1.25rem}h4,h5,h6{margin-top:1rem;font-size:1rem}p{margin-top:0;margin-bottom:1rem}strong{color:#303030}dl,ol,ul{margin-top:0;margin-bottom:1rem}dt{font-weight:700}dd{margin-bottom:.5rem}hr{position:relative;margin:1.5rem 0;border:0;border-top:1px solid #eee;border-bottom:1px solid #fff}abbr{font-size:85%;font-weight:700;color:#555;text-transform:uppercase}abbr[title]{cursor:help;border-bottom:1px dotted #e5e5e5}code,pre{font-family:Menlo,Monaco,Courier New,monospace}code{padding:.25em .5em;font-size:85%;color:#bf616a;border-radius:3px}code,pre{background-color:#f9f9f9}pre{display:block;margin-top:0;margin-bottom:1rem;padding:1rem;font-size:.8rem;line-height:1.4;white-space:pre;white-space:pre-wrap;word-break:break-all;word-wrap:break-word}pre code{padding:0;font-size:100%;color:inherit;background-color:transparent}.highlight{margin-bottom:1rem;border-radius:4px}.highlight pre{margin-bottom:0}.gist .gist-file{font-family:Menlo,Monaco,Courier New,monospace!important}.gist .markdown-body{padding:15px}.gist pre{padding:0;background-color:transparent}.gist .gist-file .gist-data{font-size:.8rem!important;line-height:1.4}.gist code{padding:0;color:inherit;background-color:transparent;border-radius:0}blockquote{padding:.5rem 1rem;margin:.8rem 0;color:#7a7a7a;border-left:.25rem solid #e5e5e5}blockquote p:last-child{margin-bottom:0}@media (min-width:30em){blockquote{padding-right:5rem;padding-left:1.25rem}}img{display:block;max-width:100%;margin:0 0 1rem;border-radius:5px}table{margin-bottom:1rem;width:100%;border:1px solid #e5e5e5;border-collapse:collapse}td,th{padding:.25rem .5rem;border:1px solid #e5e5e5}tbody tr:nth-child(odd) td,tbody tr:nth-child(odd) th{background-color:#f9f9f9}.lead{font-size:1.25rem;font-weight:300}.message{margin-bottom:1rem;padding:1rem;color:#717171;background-color:#f9f9f9}.container{max-width:38rem;padding-left:1rem;padding-right:1rem;margin-left:auto;margin-right:auto}.masthead{padding-top:1rem;padding-bottom:1rem;margin-bottom:3rem}.masthead-title{margin-top:0;margin-bottom:0;color:#505050}.masthead-title a{color:#505050}.masthead-title small{font-size:75%;font-weight:400;color:silver;letter-spacing:0}.page,.post{margin-bottom:4em}.page-title,.post-title,.post-title a{color:#303030}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-.5rem;margin-bottom:1rem;color:#9a9a9a}.related{padding-top:2rem;padding-bottom:2rem;border-top:1px solid #eee}.related-posts{padding-left:0;list-style:none}.related-posts h3{margin-top:0}.related-posts li small{font-size:75%;color:#999}.related-posts li a:hover{color:#268bd2;text-decoration:none}.related-posts li a:hover small{color:inherit}.pagination{overflow:hidden;margin-left:-1rem;margin-right:-1rem;font-family:PT Sans,Helvetica,Arial,sans-serif;color:#ccc;text-align:center}.pagination-item{display:block;padding:1rem;border:1px solid #eee}.pagination-item:first-child{margin-bottom:-1px}a.pagination-item:hover{background-color:#f5f5f5}@media (min-width:30em){.pagination{margin:3rem 0}.pagination-item{float:left;width:50%}.pagination-item:first-child{margin-bottom:0;border-top-left-radius:4px;border-bottom-left-radius:4px}.pagination-item:last-child{margin-left:-1px;border-top-right-radius:4px;border-bottom-right-radius:4px}}html{font-family:"Noto Serif",Georgia,serif}@media (min-width:48em){html{font-size:16px}}@media (min-width:58em){html{font-size:17px;line-height:1.75}}.sidebar{font-family:Roboto Slab,Helvetica,Arial,sans-serif;text-align:center;padding:2rem 1rem;color:hsla(0,0%,100%,.5);background-color:#202020}@media (min-width:48em){.sidebar{position:fixed;top:0;left:0;bottom:0;width:18rem;text-align:left}}.sidebar a{color:#fff}.sidebar-about h1{color:#fff;margin-top:0;font-size:2.25rem}.sidebar-nav{margin-bottom:1rem}.sidebar-nav-item{display:block;line-height:1.75}a.sidebar-nav-item:focus,a.sidebar-nav-item:hover{text-decoration:underline}.sidebar-nav-item.active{font-weight:700}@media (min-width:48em){.sidebar-sticky{position:absolute;right:1rem;bottom:1rem;left:1rem}}.content{padding-top:4rem;padding-bottom:4rem}@media (min-width:48em){.content{max-width:38rem;margin-left:20rem;margin-right:2rem}}@media (min-width:64em){.content{margin-left:22rem;margin-right:4rem}}@media (min-width:48em){.layout-reverse .sidebar{left:auto;right:0}.layout-reverse .content{margin-left:2rem;margin-right:20rem}}@media (min-width:64em){.layout-reverse .content{margin-left:4rem;margin-right:22rem}}.page-title,.post-title,h2,h3,h4{font-family:Roboto Slab,Helvetica,Arial,sans-serif;text-transform:capitalize}.post-title{font-size:2rem}.theme-base-08 .sidebar{background-color:#ac4142}.theme-base-08 .content a,.theme-base-08 .related-posts li a:hover{color:#ac4142}.theme-base-09 .sidebar{background-color:#d28445}.theme-base-09 .content a,.theme-base-09 .related-posts li a:hover{color:#d28445}.theme-base-0a .sidebar{background-color:#f4bf75}.theme-base-0a .content a,.theme-base-0a .related-posts li a:hover{color:#f4bf75}.theme-base-0b .sidebar{background-color:#90a959}.theme-base-0b .content a,.theme-base-0b .related-posts li a:hover{color:#90a959}.theme-base-0c .sidebar{background-color:#75b5aa}.theme-base-0c .content a,.theme-base-0c .related-posts li a:hover{color:#75b5aa}.theme-base-0d .sidebar{background-color:#6a9fb5}.theme-base-0d .content a,.theme-base-0d .related-posts li a:hover{color:#6a9fb5}.theme-base-0e .sidebar{background-color:#aa759f}.theme-base-0e .content a,.theme-base-0e .related-posts li a:hover{color:#aa759f}.theme-base-0f .sidebar{background-color:#8f5536}.theme-base-0f .content a,.theme-base-0f .related-posts li a:hover{color:#8f5536}#mc_embed_signup form{display:block;position:relative;text-align:left;padding:10px 0 10px 3%}#mc_embed_signup h2{font-weight:700;padding:0;margin:15px 0;font-size:1.4em}#mc_embed_signup input{border:1px solid #999;-webkit-appearance:none}#mc_embed_signup input[type=checkbox]{-webkit-appearance:checkbox}#mc_embed_signup input[type=radio]{-webkit-appearance:radio}#mc_embed_signup input:focus{border-color:#333}#mc_embed_signup .button{clear:both;background-color:#aaa;border:0;border-radius:4px;letter-spacing:.03em;color:#fff;cursor:pointer;display:inline-block;font-size:15px;height:32px;line-height:32px;margin:0 5px 10px 0;padding:0;text-align:center;text-decoration:none;vertical-align:top;white-space:nowrap;width:auto;-webkit-transition:all .23s ease-in-out 0s;transition:all .23s ease-in-out 0s}#mc_embed_signup .button:hover{background-color:#777}#mc_embed_signup .small-meta{font-size:11px}#mc_embed_signup .nowrap{white-space:nowrap}#mc_embed_signup .clear{clear:none;display:inline}#mc_embed_signup label{display:block;font-size:16px;padding-bottom:10px;font-weight:700}#mc_embed_signup input.email{font-family:Open Sans,Helvetica Neue,Arial,Helvetica,Verdana,sans-serif;font-size:15px;display:block;padding:0 .4em;margin:0 4% 10px 0;min-height:32px;width:58%;min-width:130px;border-radius:3px}#mc_embed_signup input.button{display:block;width:35%;margin:0 0 10px;min-width:90px}#mc_embed_signup div#mce-responses{float:left;top:-1.4em;padding:0 .5em;overflow:hidden;width:90%;margin:0 5%;clear:both}#mc_embed_signup div.response{margin:1em 0;padding:1em .5em .5em 0;font-weight:700;float:left;top:-1.5em;z-index:1;width:80%}#mc_embed_signup #mce-error-response{display:none}#mc_embed_signup #mce-success-response{color:#529214;display:none}#mc_embed_signup label.error{display:block;float:none;width:auto;margin-left:1.05em;text-align:left;padding:.5em 0}#mc_embed_signup{clear:left;font-size:14px}#mc_embed_signup input{border:1px solid hsla(0,0%,100%,.5)}#mc_embed_signup input.email{width:100%;font-family:Roboto Slab,Helvetica,Arial,sans-serif}#mc_embed_signup form{padding-left:0}#mc_embed_signup input.button{width:50%}#mc_embed_signup .button{background-color:hsla(0,0%,100%,.5);font-family:Roboto Slab,Helvetica,Arial,sans-serif;color:#ac4142}#mc_embed_signup .button:hover{background-color:#fff}code[class*=language-],pre[class*=language-]{font-family:Menlo,Monaco,Courier New,monospace;font-size:14px}</style><meta name="generator" content="Gatsby 2.15.36"/><link href="https://fonts.googleapis.com/css?family=Roboto+Slab:700|Noto+Serif:400,400i,700,700i" rel="stylesheet"/><link as="script" rel="preload" href="/app-8fd481ddfb0f3dd8838f.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-4505edc6c7cc65e9d77e.js"/><link as="script" rel="preload" href="/commons-a8678319dbc46017a25a.js"/><link as="script" rel="preload" href="/webpack-runtime-85745c3f6b306aa14381.js"/><link as="fetch" rel="preload" href="/page-data\2017-07-14-react-sequencer-redux\page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="theme-base-08"><div class="sidebar"><div class="container sidebar-sticky"><div class="sidebar-about"><h1><a href="/">Unlikenesses</a></h1><p class="lead"></p></div><nav class="sidebar-nav"><a class="sidebar-nav-item" href="/">Blog</a><a class="sidebar-nav-item" href="/about/">About</a><a class="sidebar-nav-item" href="/experiments/">Experiments</a><a class="sidebar-nav-item" href="https://twitter.com/unlikenesses" target="_blank" rel="noopener noreferrer">Twitter</a><a class="sidebar-nav-item" href="https://github.com/unlikenesses" target="_blank" rel="noopener noreferrer">Github</a><a class="sidebar-nav-item" href="http://codepen.io/unlikenesses/" target="_blank" rel="noopener noreferrer">Codepen</a></nav><div><a class="twitter-follow-button" href="https://twitter.com/unlikenesses" target="_blank" rel="noopener noreferrer">Follow @unlikenesses</a></div><p>© <!-- -->2019</p></div></div><div class="content container"><div class="post"><h1 class="post-title">react sequencer redux</h1><span class="post-date">14 July, 2017</span><div><p>In the <a href="http://unlikenesses.com/2017/07/05/react-sequencer/">previous article</a> we created a simple sequencer in React. In this one we're going to port the state over to <a href="http://redux.js.org">Redux</a>. To do this we need to install the <code>redux</code> and <code>react-redux</code> packages with <code>npm install --save redux react-redux</code>. </p>
<p>My aim is to take the previous non-Redux version and convert it bit by bit. This might end up being more painful than starting from scratch but it will allow us to see the differences in architecture more clearly. Unlike most tutorials I'm going to start with an <a href="http://redux.js.org/docs/basics/Actions.html">action</a>. For now we'll take something simple, the toggle play button. Create a folder in <code>src</code> called <code>actions</code> and a file in it called <code>index.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">togglePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> <span class="token string">'TOGGLE_PLAY'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>We return the action type <code>TOGGLE_PLAY</code> in the action definition <code>togglePlay</code>. Since there is only one play button and we are not updating any other properties the <code>type</code> of the action is the only information we need to pass. The next task is to define a <a href="http://redux.js.org/docs/basics/Reducers.html">reducer</a> to handle this action and update the state accordingly. Create another new folder in <code>src</code> called <code>reducers</code> and a file there called <code>index.js</code>. We'll just create one reducer for now, called <code>controls</code>, but since we'll be creating more later, we'll also use <code>combineReducers</code> to put them all into one reducer:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">controls</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span> playing<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'TOGGLE_PLAY'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                playing<span class="token punctuation">:</span> <span class="token operator">!</span>state<span class="token punctuation">.</span>playing
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    controls
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> reducer<span class="token punctuation">;</span></code></pre></div>
<p>Since the only piece of state we're moving into Redux for now is the <code>playing</code> property, that's all we need to set in the reducer's first argument as the default state. We then check if the <code>action</code> is <code>TOGGLE_PLAY</code>, and if so return a copy of the state with its <code>playing</code> property toggled.</p>
<p>The next thing is to create a container which has access to this state. We can re-use the root <code>App</code> component we already have. Create a new folder in <code>src</code> called <code>containers</code> and move <code>App.js</code> into there. We'll need to add a couple of <code>import</code> statements at the top:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> togglePlay <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../actions'</span><span class="token punctuation">;</span></code></pre></div>
<p>And after the <code>class</code> definition, we need a few things:</p>
<p>First, something to pass the Redux state to our container's <code>props</code>: </p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> ownProps</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        playing<span class="token punctuation">:</span> state<span class="token punctuation">.</span>controls<span class="token punctuation">.</span>playing
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>This grabs the value of the <code>controls</code> reducer's state and passes it as a <code>playing</code> prop to the container. We also need to get the toggle action and give that as a prop:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">togglePlaying</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">togglePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>This means that <code>togglePlaying</code> will be a new prop available in the <code>App</code> container, which when called dispatches the <code>togglePlay</code> action we created earlier.</p>
<p>Finally we need to connect it all up to the Redux store:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>
    mapStateToProps<span class="token punctuation">,</span>
    mapDispatchToProps
<span class="token punctuation">)</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>As a last detail, now that we have these two new props, we can replace the existing ones in the container's invocation of the <code>Controls</code> component:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>Controls 
    bpm<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>bpm<span class="token punctuation">}</span> 
    handleChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeBpm<span class="token punctuation">}</span> 
    playing<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>playing<span class="token punctuation">}</span> 
    togglePlaying<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>togglePlaying<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span></code></pre></div>
<p>The next step to get this working is to wrap the <code>App</code> container in a <code>Provider</code> component which <a href="http://redux.js.org/docs/basics/UsageWithReact.html#passing-the-store">passes the store</a> to all container components. So we import a few modules:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducers'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./containers/App'</span><span class="token punctuation">;</span></code></pre></div>
<p>... create the store:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>... and render the <code>App</code> component within the <code>Provider</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">></span><span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>One last thing: we need to watch for when the <code>props.playing</code> property changes and set or clear the timer as appropriate. We can do this with the <code>componentWillReceiveProps</code> lifecycle hook. Add this in <code>App</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> prevProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>playing <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>playing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">togglePlaying</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>playing<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now the app should be working as before.</p>
<p>Let's do the same with the BPM control. Add a new action to the <code>actions/index.js</code> file:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">changeBpm</span><span class="token punctuation">(</span><span class="token parameter">bpm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> <span class="token string">'CHANGE_BPM'</span><span class="token punctuation">,</span>
        bpm
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Unlike the <code>togglePlay</code> action, this one takes a <code>bpm</code> value and returns it as a property of the action. In our reducers file we can add this as a <code>case</code> to our <code>switch</code> statement:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">case</span> <span class="token string">'CHANGE_BPM'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        bpm<span class="token punctuation">:</span> action<span class="token punctuation">.</span>bpm
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>We also need to add the default state to the reducer:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">controls</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span> playing<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> bpm<span class="token punctuation">:</span> <span class="token number">220</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></code></pre></div>
<p>Then add the appropriate props to <code>App</code>. In <code>mapStateToProps</code> add the new <code>bpm</code> prop:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">return</span> <span class="token punctuation">{</span>
    playing<span class="token punctuation">:</span> state<span class="token punctuation">.</span>controls<span class="token punctuation">.</span>playing<span class="token punctuation">,</span>
    bpm<span class="token punctuation">:</span> state<span class="token punctuation">.</span>controls<span class="token punctuation">.</span>bpm
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Then in <code>mapDispatchToProps</code> add the new action:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">togglePlaying</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">togglePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">changeBpm</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">bpm</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">changeBpm</span><span class="token punctuation">(</span>bpm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>We can then update our invocation of <code>Controls</code> so that it's only using the Redux props:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>Controls 
    bpm<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>bpm<span class="token punctuation">}</span> 
    handleChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>changeBpm<span class="token punctuation">}</span> 
    playing<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>playing<span class="token punctuation">}</span> 
    togglePlaying<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>togglePlaying<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span></code></pre></div>
<p>And in the <code>Controls</code> component modify the <code>onChange</code> handler to pass the input's value:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> props<span class="token punctuation">.</span><span class="token function">handleChange</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre></div>
<p>Finally, back in <code>App</code> we can update our <code>componentWillReceiveProps</code> hook:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>bpm <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>bpm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeBpm</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>bpm<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>If we remove the state update and modify our reference to <code>playing</code> in <code>changeBpm</code>, it should now be working as previously:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">changeBpm</span><span class="token punctuation">(</span><span class="token parameter">bpm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>playing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timerId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>We can now remove <code>playing</code> and <code>bpm</code> from the <code>App</code> component's state, and update <code>setTimer</code> to reference <code>this.props.bpm</code> instead of <code>this.state.bpm</code>.</p>
<p>Now to take care of the pads. First let's create an action <code>togglePad</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">togglePad</span><span class="token punctuation">(</span><span class="token parameter">row<span class="token punctuation">,</span> col</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> <span class="token string">'TOGGLE_PAD'</span><span class="token punctuation">,</span>
        row<span class="token punctuation">,</span>
        col
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This takes a row and column as well as the action type. We can now create a reducer (in the same <code>reducers/index.js</code> file) which has an initial <code>pads</code> state and a case to handle toggling a pad - both taken from the <code>App</code> component:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span> pads<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'TOGGLE_PAD'</span><span class="token punctuation">:</span>
            <span class="token keyword">let</span> pads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>pads<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> padState <span class="token operator">=</span> pads<span class="token punctuation">[</span>action<span class="token punctuation">.</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>action<span class="token punctuation">.</span>col<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>padState <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                pads<span class="token punctuation">[</span>action<span class="token punctuation">.</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>action<span class="token punctuation">.</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                pads<span class="token punctuation">[</span>action<span class="token punctuation">.</span>row<span class="token punctuation">]</span><span class="token punctuation">[</span>action<span class="token punctuation">.</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token punctuation">{</span> pads <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Don't forget to add <code>main</code> to the <code>combineReducers</code> method.</p>
<p>Now add the new <code>pads</code> state as a prop to <code>App</code> in <code>mapStateToProps</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">pads<span class="token punctuation">:</span> state<span class="token punctuation">.</span>main<span class="token punctuation">.</span>pads</code></pre></div>
<p>and finally pass it to the <code>Pads</code> component:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">pads<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>pads<span class="token punctuation">}</span></code></pre></div>
<p>Hopefully the pads will be rendering ok but now they're coming from the Redux store. We can now add the new reducer to our <code>mapDispatchToProps</code> method in <code>App</code>. </p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function-variable function">togglePad</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">row<span class="token punctuation">,</span> col</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">togglePad</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>and reference it in our invocation to <code>Pads</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">toggleActive<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>togglePad<span class="token punctuation">}</span></code></pre></div>
<p>We also need to import it at the top:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> togglePlay<span class="token punctuation">,</span> changeBpm<span class="token punctuation">,</span> togglePad <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../actions'</span><span class="token punctuation">;</span></code></pre></div>
<p>We can also now delete <code>toggleActive</code> from <code>App</code> (and its binding in the <code>constructor</code>).</p>
<p>Now just update the <code>checkPad</code> method to loop over <code>this.props.pads</code> instead of <code>this.state.pads</code> and everything should be working as usual. We can also now remove <code>pads</code> from the state in <code>App</code>.</p>
<p>The final source code is <a href="https://github.com/unlikenesses/react-sequencer-redux">on GitHub</a>.</p></div></div><div class="related"><ul class="related-posts"><li><h3>Previous<!-- -->:<!-- --> <a href="/2017-07-05-react-sequencer/">react sequencer<!-- --> <small>05 July, 2017</small></a></h3></li><li><h3>Next<!-- -->:<!-- --> <a href="/2017-07-18-laravel-and-react/">laravel and react<!-- --> <small>18 July, 2017</small></a></h3></li></ul></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2017-07-14-react-sequencer-redux/";window.webpackCompilationHash="b0f24b451a3b2ebddb5e";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-8fd481ddfb0f3dd8838f.js"],"component---src-templates-index-js":["/component---src-templates-index-js-37ce12bb80a9f7262bef.js"],"component---src-templates-post-js":["/component---src-templates-post-js-4505edc6c7cc65e9d77e.js"],"component---src-templates-page-js":["/component---src-templates-page-js-dd9a065be189ea504205.js"],"component---src-pages-404-js":["/component---src-pages-404-js-7ef4343af97b4bd9bf54.js"]};/*]]>*/</script><script src="/webpack-runtime-85745c3f6b306aa14381.js" async=""></script><script src="/commons-a8678319dbc46017a25a.js" async=""></script><script src="/component---src-templates-post-js-4505edc6c7cc65e9d77e.js" async=""></script><script src="/app-8fd481ddfb0f3dd8838f.js" async=""></script></body></html>