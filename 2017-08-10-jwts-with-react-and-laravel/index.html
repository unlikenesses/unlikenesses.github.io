<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.fc76a6e3011e95c33b1f.css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}

/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}a{background-color:transparent}small{font-size:80%}h1,p{margin:0}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e2e8f0}h1{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}.bg-white{--bg-opacity:1;background-color:#fff;background-color:rgba(255,255,255,var(--bg-opacity))}.bg-gray-100{--bg-opacity:1;background-color:#f7fafc;background-color:rgba(247,250,252,var(--bg-opacity))}.bg-gray-300{--bg-opacity:1;background-color:#e2e8f0;background-color:rgba(226,232,240,var(--bg-opacity))}.hover\:bg-gray-400:hover{--bg-opacity:1;background-color:#cbd5e0;background-color:rgba(203,213,224,var(--bg-opacity))}.rounded{border-radius:.25rem}.flex{display:flex}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-between{justify-content:space-between}.font-bold{font-weight:700}.text-sm{font-size:.875rem}.text-lg{font-size:1.125rem}.text-xl{font-size:1.25rem}.text-3xl{font-size:1.875rem}.text-5xl{font-size:3rem}.my-4{margin-top:1rem;margin-bottom:1rem}.mx-auto{margin-left:auto;margin-right:auto}.mr-3{margin-right:.75rem}.p-6{padding:1.5rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.px-4{padding-left:1rem;padding-right:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.pt-2{padding-top:.5rem}.pb-3{padding-bottom:.75rem}.pb-5{padding-bottom:1.25rem}.pl-5{padding-left:1.25rem}.pt-6{padding-top:1.5rem}.pb-6{padding-bottom:1.5rem}.shadow{box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06)}.hover\:shadow-md:hover{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.text-left{text-align:left}.text-gray-600{--text-opacity:1;color:#718096;color:rgba(113,128,150,var(--text-opacity))}.text-gray-700{--text-opacity:1;color:#4a5568;color:rgba(74,85,104,var(--text-opacity))}.text-pink-600{--text-opacity:1;color:#d53f8c;color:rgba(213,63,140,var(--text-opacity))}.hover\:text-gray-700:hover{--text-opacity:1;color:#4a5568;color:rgba(74,85,104,var(--text-opacity))}.hover\:text-gray-800:hover{--text-opacity:1;color:#2d3748;color:rgba(45,55,72,var(--text-opacity))}.uppercase{text-transform:uppercase}.capitalize{text-transform:capitalize}.no-underline{text-decoration:none}.hover\:underline:hover{text-decoration:underline}.w-1\/2{width:50%}.w-full{width:100%}.nunito{font-family:Nunito,sans-serif}p{margin-bottom:.75rem}h2{font-size:1.5rem;font-weight:700;padding-bottom:.75rem}h3{font-size:1.25rem}h3,h4{font-weight:700;padding-top:.75rem;padding-bottom:.75rem}h4{font-size:1.125rem}code{--text-opacity:1;color:#ed64a6;color:rgba(237,100,166,var(--text-opacity));--bg-opacity:1;background-color:#fff5f7;background-color:rgba(255,245,247,var(--bg-opacity));border-radius:.375rem;padding-left:.25rem;padding-right:.25rem}pre code{padding-left:0;padding-right:0}a{color:#ed64a6;color:rgba(237,100,166,var(--text-opacity));text-decoration:underline}a,blockquote{--text-opacity:1}blockquote{--border-opacity:1;border-color:#ed64a6;border-color:rgba(237,100,166,var(--border-opacity));border-left-width:4px;padding-left:1rem;margin-bottom:.75rem;color:#4a5568;color:rgba(74,85,104,var(--text-opacity))}ul{list-style-type:disc;margin-bottom:.5rem}ol,ul{list-style-position:inside}ol{list-style-type:decimal}</style><meta name="generator" content="Gatsby 2.18.17"/><link href="https://fonts.googleapis.com/css?family=Nunito:400,700" rel="stylesheet"/><link as="script" rel="preload" href="/webpack-runtime-9dc4e232ce5257c7390e.js"/><link as="script" rel="preload" href="/commons-e4d1cf937e8afc4814a6.js"/><link as="script" rel="preload" href="/app-d804ca8346e83b6629a1.js"/><link as="script" rel="preload" href="/styles-7cbd95f2e426d3237055.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-f482eaf3e97d399ee61e.js"/><link as="fetch" rel="preload" href="/page-data\2017-08-10-jwts-with-react-and-laravel\page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="bg-gray-100 nunito"><div class="container mx-auto flex flex-wrap py-6"><header class="pl-5 pb-6"><a class="font-bold text-gray-700 uppercase hover:text-gray-700 text-5xl no-underline" href="/">Unlikenesses <span class="text-xl">A PHP Developer</span></a><nav><a class="no-underline mr-3 text-gray-600 hover:text-gray-700" href="https://twitter.com/unlikenesses" target="_blank" rel="noopener noreferrer">Twitter</a><a class="no-underline mr-3 text-gray-600 hover:text-gray-700" href="https://github.com/unlikenesses" target="_blank" rel="noopener noreferrer">GitHub</a><a class="no-underline text-gray-600 hover:text-gray-700" href="http://codepen.io/unlikenesses/" target="_blank" rel="noopener noreferrer">CodePen</a></nav></header><section class="w-full flex flex-col items-center px-3"><article class="w-full flex flex-col shadow my-4"><div class="bg-white flex flex-col justify-start p-6"><h1 class="text-3xl font-bold text-gray-700 capitalize">JWTs with React and Laravel</h1><span class="text-sm pb-3 text-gray-600">10 August, 2017</span><div class="text-gray-700"><p>This is a tutorial on how to get <a href="https://jwt.io">JSON Web tokens</a> working so that React can securely communicate with a back-end API. For the purposes of this tutorial I'll be using <a href="https://laravel.com">Laravel</a> 5.4 for the back-end and <a href="https://facebook.github.io/react">React</a> for the front-end. The finished code can be seen <a href="https://github.com/unlikenesses/react-laravel-jwt">here</a>.</p>
<h4>Getting started</h4>
<p>First thing is to create a new Laravel project - I do this in the command line to create a project called <code>jwt</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">laravel new jwt</code></pre></div>
<p>We want a users table; we won't be using most of the Laravel auth scaffolding, but let's use it anyway to set up the users table quickly:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">php artisan make:auth</code></pre></div>
<p>For the API let's just have one resource, <code>clients</code>. For this we'll set up the model and migration with <code>artisan</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">php artisan make:model Client -m</code></pre></div>
<p>In the <code>clients</code> migration add a few fields - I've added <code>name</code>, <code>address</code> and <code>telephone</code>:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'clients'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Blueprint <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">increments</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">string</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'address'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">string</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'telephone'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Then migrate to set up these tables (I'm assuming you've created a database for this project &#x26; configured Laravel to use it in the <code>.env</code> file):</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">php artisan migrate</code></pre></div>
<p>And let's seed the database. First create a <code>ClientFactory.php</code> file in the <code>database/factories</code> folder. This will use <a href="https://github.com/fzaninotto/Faker">Faker</a> to generate fake details for each client:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token variable">$factory</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">define</span><span class="token punctuation">(</span>App\<span class="token package">Client</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Faker\<span class="token package">Generator</span> <span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token variable">$password</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'address'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">address</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'telephone'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">phoneNumber</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Then in <code>seeds/DatabaseSeeder.php</code> we can call this factory in the <code>run</code> method to create 50 clients:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token function">factory</span><span class="token punctuation">(</span>App\<span class="token package">Client</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Now run <code>php artisan db:seed</code> and we have our dummy data.</p>
<h4>Setting up JWT</h4>
<p>We'll be using <a href="https://github.com/tymondesigns/jwt-auth">jwt-auth</a> to get JWT authentication working with Laravel. Follow the <a href="https://github.com/tymondesigns/jwt-auth/wiki/Installation">installation instructions</a>. The project's <a href="https://github.com/tymondesigns/jwt-auth/wiki/Creating-Tokens">creating tokens</a> page gives us a basic method to authenticate a user. For now let's test it in an API development tool like <a href="https://www.getpostman.com">Postman</a>. Create a new controller:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">php artisan make:controller FrontEndUserController</code></pre></div>
<p>I'm including a quick method to create a user so we can attempt logins:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">signUp</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$user</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'email'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">email</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'password'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">bcrypt</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>In our <code>routes/api.php</code> file we can create a route for this and another one for when the user tries to sign in:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php">Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/signup'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'FrontEndUserController@signUp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/signin'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'FrontEndUserController@signIn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>If we now use Postman to make a POST request to <code>[project_path]/api/signup</code>, with an email and password, it should create the new user (check this in the database. If it doesn't work you might need to make the <code>username</code> field nullable).</p>
<p>Now for the magic - the sign in method using JWT. We're just going to re-use the method giving in the <a href="https://github.com/tymondesigns/jwt-auth/wiki/Creating-Tokens">docs</a> mentioned above:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">signIn</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token variable">$token</span> <span class="token operator">=</span> JWTAuth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">attempt</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'email'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">email</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'password'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'error'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'invalid_credentials'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>JWTException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'error'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'could_not_create_token'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>If you now POST to the <code>signin</code> route with the email and password you created before, you should get back a token similar to this:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"></code></pre></div>
<h4>Calling the API</h4>
<p>Let's test the authentication is working. Create a <code>ClientController</code>:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">php artisan make:controller ClientController</code></pre></div>
<p>In that for now we'll just create an <code>index</code> method that return all clients (not ideal for an API but this tutorial is more about JWTs than developing APIs):</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> Client<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>In the <code>api.php</code> routes we'll create a new group that uses the built-in <code>jwt.auth</code> middleware:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php">Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'middleware'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'jwt.auth'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/clients'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'ClientController@index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>We'll need to register this middleware to the <code>$routeMiddleware</code> array in <code>app/Http/Kernel.php</code>:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token single-quoted-string string">'jwt.auth'</span> <span class="token operator">=</span><span class="token operator">></span> \<span class="token package">Tymon<span class="token punctuation">\</span>JWTAuth<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>GetUserFromToken</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span></code></pre></div>
<p>Now if you make a GET call in Postman to <code>[project_path]/api/clients</code> you should get this error:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span><span class="token string">"error"</span><span class="token punctuation">:</span><span class="token string">"token_not_provided"</span><span class="token punctuation">}</span></code></pre></div>
<p>To remedy this, pass an authorization header, with the <code>key</code> of <code>Authorization</code> and <code>value</code> of <code>Bearer [token]</code> (copy the token you created earlier). Now run the GET call again and you should get the list of clients back as JSON. (NB. If you get a <code>token_expired</code> error just call the previous POST endpoint and get a new token.)</p>
<h4>Setting up React</h4>
<p>First let's remove the <code>vue</code> line from <code>devDependencies</code> in <code>package.json</code>, and install the existing npm dependencies with <code>npm install</code>. Then install react and react-dom:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">npm install --save react react-dom</code></pre></div>
<p>Now remove any references to Vue (this won't be necessary in Laravel 5.5). Delete <code>Example.vue</code> from the <code>resources/assets/js/components</code> folder. Then in <code>resources/assets/js/app.js</code>, replace all the VueJS code with this:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./components/App'</span><span class="token punctuation">;</span>


ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>This simply imports the React modules, imports our root component and attaches it to a <code>div</code> with the id <code>root</code> on our homepage. So now create the <code>components/App.js</code> file and put some temporary code there:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>h1<span class="token operator">></span>Hello<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code></pre></div>
<p>Now we need to put that <code>#root</code> div in <code>home.blade.php</code> - put it anywhere you want. I just stuck it in the middle of the Bootstrap div-nest:</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-md-8 col-md-offset-2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>panel panel-default<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>panel-body<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></div>
<p>And modify the base route to point here (in <code>routes/web.php</code>):</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php">Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'home'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Now to compile the React code with Laravel's Mix we need to modify the <code>webpack.mix.js</code> file:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">mix<span class="token punctuation">.</span><span class="token function">react</span><span class="token punctuation">(</span><span class="token string">'resources/assets/js/app.js'</span><span class="token punctuation">,</span> <span class="token string">'public/js'</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">sass</span><span class="token punctuation">(</span><span class="token string">'resources/assets/sass/app.scss'</span><span class="token punctuation">,</span> <span class="token string">'public/css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Now run <code>npm run watch</code> and it'll compile the JavaScript - point your browser at <code>[project-path]</code> and you should see the "Hello" string on the homepage.</p>
<h4>React Sign-In page and routing</h4>
<p>(NB. I had to follow the instructions <a href="https://github.com/JeffreyWay/laravel-mix/issues/76">here</a> to get the spread operator working with Laravel Mix.)</p>
<p>For this example the React app will have 3 pages: Home, Login and Clients. We'll use <a href="https://github.com/ReactTraining/react-router">React Router 4</a> to set up the routing. We'll want Home and Login to be accessible to non-logged in users, but only logged-in users can view the Clients page. In this section I'll detail setting up the routing and the login page.</p>
<p>First let's install the router: <code>npm install react-router-dom --save</code>. Then in <code>App.js</code> we can import the modules we need:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> HashRouter<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> Switch<span class="token punctuation">,</span> NavLink<span class="token punctuation">,</span> Redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span></code></pre></div>
<p>Now we re-write its <code>render</code> method. We'll use react-router's <code>HashRouter</code> to contain our routes -- see their documentation for more info:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>HashRouter<span class="token operator">></span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>Menu <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>Switch<span class="token operator">></span>
            <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">'/'</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">'/login'</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>Login <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>HashRouter<span class="token operator">></span></code></pre></div>
<p>You'll notice that the <code>Login</code> route uses a slightly different method to render the component - this is because we'll be passing some properties to it later. There's also a new <code>Menu</code> component there at the top - we can add this under the <code>App</code> class declaration in <code>App.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">Menu</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ul<span class="token operator">></span>
        <span class="token operator">&lt;</span>li<span class="token operator">></span>
            <span class="token operator">&lt;</span>NavLink exact activeClassName<span class="token operator">=</span><span class="token string">"active"</span> to<span class="token operator">=</span><span class="token string">"/"</span><span class="token operator">></span>
                Home
            <span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token operator">&lt;</span>li<span class="token operator">></span>
            <span class="token operator">&lt;</span>NavLink exact activeClassName<span class="token operator">=</span><span class="token string">"active"</span> to<span class="token operator">=</span><span class="token string">"/login"</span><span class="token operator">></span>
                Login
            <span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token operator">&lt;</span>li<span class="token operator">></span>
            <span class="token operator">&lt;</span>NavLink exact activeClassName<span class="token operator">=</span><span class="token string">"active"</span> to<span class="token operator">=</span><span class="token string">"/clients"</span><span class="token operator">></span>
                Clients
            <span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The <code>Clients</code> link is in there but we can ignore it for now. One last thing in <code>App.js</code>: import the <code>Home</code> and <code>Login</code> components:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">'./Home'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Login <span class="token keyword">from</span> <span class="token string">'./Login'</span><span class="token punctuation">;</span></code></pre></div>
<p>Now let's create the <code>Home</code> component - it can really be anything you like. My one just prints the word "Home":</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Home</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">></span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Home<span class="token punctuation">;</span></code></pre></div>
<p>The <code>Login</code> component is more interesting. Create a basic React class. This will be what React calls a <a href="https://facebook.github.io/react/docs/forms.html">"controlled component"</a>, i.e. a component containing a form with fields whose values are controlled by the component's state. So in our component's constructor, let's set up the intial form state (there'll be 2 fields, <code>email</code> and <code>password</code>):</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
    email<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Then in the <code>render</code> method we have a simple form (it's using some Bootstrap class names for simple styling):</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">onSubmit</span><span class="token attr-value"><span class="token punctuation">=</span>{this.handleSubmit}</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>form-group<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
            <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>email<span class="token punctuation">'</span></span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>email<span class="token punctuation">'</span></span>
            <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>form-control<span class="token punctuation">'</span></span>
            <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Email<span class="token punctuation">'</span></span>
            <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span>{this.state.email}</span>
            <span class="token attr-name">onChange</span><span class="token attr-value"><span class="token punctuation">=</span>{this.handleChange}</span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>form-group<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
            <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>password<span class="token punctuation">'</span></span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>password<span class="token punctuation">'</span></span>
            <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>form-control<span class="token punctuation">'</span></span>
            <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Password<span class="token punctuation">'</span></span>
            <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span>{this.state.password}</span>
            <span class="token attr-name">onChange</span><span class="token attr-value"><span class="token punctuation">=</span>{this.handleChange}</span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>form-group<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>submit<span class="token punctuation">'</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>btn<span class="token punctuation">'</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Login<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre></div>
<p>As you can see there's an <code>email</code> field and a <code>password</code> field, both of whose values are set by the component's state. Both fields also have an <code>onChange</code> attribute, which calls the component's <code>handleChange</code> method. This will simply update the state when the user types in a given field:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> name <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Because it checks for the field's <code>name</code> attribute we can use the same method for both input fields. Don't forget to add this method to the constructor:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>We also have an <code>onSubmit</code> attribute for the form, which calls a method called <code>handleSubmit</code>. We want this to call the Laravel <code>api/signin</code> route we created earlier. We can use <a href="https://github.com/mzabriskie/axios">Axios</a> for this since it's already part of Laravel's <code>package.json</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/signin'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        email<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>email<span class="token punctuation">,</span>
        password<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>password
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> token <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>All this does is <code>POST</code> the component's email and password state to our endpoint, and logs the token to the console. (Bind this in the constructor: <code>this.handleSubmit = this.handleSubmit.bind(this);</code>.) If you try running this now and logging in (and providing you use the correct email/password) you should see a JWT token in the console.</p>
<p>Somewhere we'll need to keep track of whether a user is logged in or not. We can do that in a number of ways - for the purposes of this project I'll keep it simple and use the <code>App</code> component's state. So in its constructor, add this:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
    isAuthenticated<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    token<span class="token punctuation">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>We'll also need a method to set these properties when a login is successful (this is also in <code>App</code>):</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        isAuthenticated<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        token<span class="token punctuation">:</span> token
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(Bind this method in the constructor: <code>this.authenticate = this.authenticate.bind(this);</code>).</p>
<p>Now we can pass these as properties to the <code>Login</code> component:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">'/login'</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>Login authenticate<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>authenticate<span class="token punctuation">}</span> isAuthenticated<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isAuthenticated<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span></code></pre></div>
<p>Now in the <code>Login</code> component we can modify the <code>axios</code> call to pass the token to the parent's <code>authenticate</code> method:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>While we're here we can also check to see if a user is logged in and not display the form if so:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isAuthenticated <span class="token operator">?</span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span>You are already logged <span class="token keyword">in</span><span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token punctuation">:</span>
    <span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">></span>
        <span class="token comment">// Form stuff here</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>
<span class="token punctuation">}</span></code></pre></div>
<p>Finally let's add a <code>Logout</code> link to the menu:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>props<span class="token punctuation">.</span>isAuthenticated <span class="token operator">?</span>
    <span class="token operator">&lt;</span>li<span class="token operator">></span>
        <span class="token operator">&lt;</span>a onClick<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>logout<span class="token punctuation">}</span><span class="token operator">></span>
            Logout
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
    <span class="token punctuation">:</span>
    <span class="token keyword">null</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This will check if <code>isAuthenticated</code> is <code>true</code> - if so, show the Logout link with an <code>onClick</code> handler. We'll need to pass these properties to the <code>Menu</code> in the router:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>Menu isAuthenticated<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isAuthenticated<span class="token punctuation">}</span> logout<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>logout<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span></code></pre></div>
<p>...and create the <code>logout</code> method in <code>App</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        isAuthenticated<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        token<span class="token punctuation">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>As you can see this just resets the state to its original values. As usual, bind this method in the constructor: <code>this.logout = this.logout.bind(this);</code>.</p>
<h4>Private routes</h4>
<p>We have a link to the <code>clients</code> page in our menu, but we haven't set up the route or the component yet. For creating private routes (i.e. routes that can only be accessed by logged-in users) I'm following the example in the official <a href="https://reacttraining.com/react-router/web/example/auth-workflow">react-router documentation</a>. This uses a bespoke <code>PrivateRoute</code> component which will either display the component passed to it (in our case, <code>Clients</code>) or, if not logged in, it will redirect to a given route. My version is the same but with a couple of small tweaks. First let's set up the route in the <code>App</code> component:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>PrivateRoute exact path<span class="token operator">=</span><span class="token string">'/clients'</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Clients<span class="token punctuation">}</span> isAuthenticated<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isAuthenticated<span class="token punctuation">}</span> token<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>token<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span></code></pre></div>
<p>And here's my version of the <code>PrivateRoute</code> component (which I also place in <code>App.js</code>):</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">PrivateRoute</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> component<span class="token punctuation">:</span> Component<span class="token punctuation">,</span> isAuthenticated<span class="token punctuation">,</span> token<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Route <span class="token punctuation">{</span><span class="token operator">...</span>rest<span class="token punctuation">}</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">props</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
        isAuthenticated <span class="token operator">?</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>rest<span class="token punctuation">}</span> token<span class="token operator">=</span><span class="token punctuation">{</span>token<span class="token punctuation">}</span> isAuthenticated<span class="token operator">=</span><span class="token punctuation">{</span>isAuthenticated<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>Redirect to<span class="token operator">=</span><span class="token punctuation">{</span> <span class="token punctuation">{</span>
                pathname<span class="token punctuation">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
                state<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token punctuation">:</span> props<span class="token punctuation">.</span>location <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>It's not the most readable of code so I'll go through it bit by bit. The first thing to note is the arguments it takes:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token punctuation">{</span> component<span class="token punctuation">:</span> Component<span class="token punctuation">,</span> isAuthenticated<span class="token punctuation">,</span> token<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>The first three arguments correspond to the three properties we pass it in our router. (The first parameter, with a colon, renames the <code>component</code> parameter to <code>Component</code> - this is necessary [I presume] because JSX considers tags that begin with a lower-case letter to be an HTML tag rather than a React component.) We need to pass in the <code>isAuthenticated</code> state to know whether or not to redirect to the login page. And we need the <code>token</code> to give to the <code>Clients</code> component when we finally build it. The last parameter, <code>...rest</code> uses the <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Functions/rest_parameters">rest parameter syntax</a> to gather up any remaining properties.</p>
<p>Moving into the body of the component itself, it's comprised of a single <code>&#x3C;Route></code> component. It uses the <a href="https://reacttraining.com/react-router/web/api/Route/render-func">render</a> function to allow us to programmatically decide on which component is rendered on this route. The <code>render</code> function takes the <a href="https://reacttraining.com/react-router/web/api/Route/Route-props">route props</a> as an argument and if the user is authenticated (i.e. if <code>isAuthenticated</code> is true), it renders the component passed to <code>PrivateRoute</code> (passing it the <code>token</code> prop so we can make calls to the API later). If the user is not authenticated it renders a <a href="https://reacttraining.com/react-router/web/api/Redirect">Redirect component</a>. This uses the <a href="https://reacttraining.com/react-router/web/api/Redirect/to-object">to object</a> to give the location we're redirecting to (in this case the <code>login</code> route) and where we're coming from (using the <code>Route</code> component's property <a href="https://reacttraining.com/react-router/web/api/location"><code>location</code></a>). This can be useful to display messages on the login page.</p>
<p>Now we can add a private route pointing to the <code>Clients</code> component. Add this line within the <code>Switch</code> block:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>PrivateRoute exact path<span class="token operator">=</span><span class="token string">'/clients'</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Clients<span class="token punctuation">}</span> isAuthenticated<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>isAuthenticated<span class="token punctuation">}</span> token<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>token<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span></code></pre></div>
<p>This passes the three props - <code>component</code>, <code>isAuthenticated</code> and <code>token</code> - to the <code>PrivateRoute</code> component. Now we need to create....</p>
<h4>The Clients component</h4>
<p>Create a new React component called <code>Clients</code>. We'll need some state to hold the clients, so let's put that in the constructor:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
        clients<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Our <code>render</code> method is pretty simple - we just <code>map</code> over the <code>clients</code> array and print out each client's details:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>h1<span class="token operator">></span>Clients<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
            <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">client<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span>
                    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"client"</span> key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token operator">></span>
                        <span class="token punctuation">{</span>client<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">></span>
                        <span class="token punctuation">{</span>client<span class="token punctuation">.</span>address<span class="token punctuation">}</span><span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">></span>
                        <span class="token punctuation">{</span>client<span class="token punctuation">.</span>telephone<span class="token punctuation">}</span>
                        <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now we just need to make a call to the API when the component mounts to request the clients. We'll use Axios again, and pass the <code>Authorization</code> headers:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClients</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">getClients</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>token<span class="token punctuation">;</span>
    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/clients'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        headers<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">'Authorization'</span><span class="token punctuation">:</span> <span class="token string">'Bearer '</span> <span class="token operator">+</span> token <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> clients <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> clients <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>As you can see we grab the <code>token</code> from the component's <code>props</code>, and if the call is successful we update the component's <code>state</code>. Now just <code>import</code> this component in <code>App</code> and try it out. When you first click on the <code>Clients</code> link in the nav you should be redirected to the Login page. After logging in and clicking the <code>Clients</code> link you should be able to see the list of clients returned by the API.</p>
<h4>Cleaning up</h4>
<p>There's more to do, but first let's tidy a few things up. First, it would be good if, on a successful login, the Login component redirected to the page the user originally tried to access. Again this code is heavily indebted to the <a href="https://reacttraining.com/react-router/web/example/auth-workflow">official docs</a> for React-Router. All we need to do is add a check at the beginning of the <code>render</code> method of the <code>Login</code> component. If we're already logged in, and if we have a <code>location</code> property (i.e. if we've been redirected here from another, protected, page), then just render a <code>Redirect</code> component pointing to that page. First import the <code>Redirect</code> component at the top of the <code>Login</code> component:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span></code></pre></div>
<p>Then at the beginning of the <code>render</code> method, add this conditional:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isAuthenticated <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>location<span class="token punctuation">.</span>state <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>Redirect to<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>location<span class="token punctuation">.</span>state<span class="token punctuation">.</span>from<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now when you click on the Clients link, then login, you should be redirected back to the Clients page.</p>
<p>What about if you enter false credentials? If you try to log in now with the wrong username / password you will get an error like this:</p>
<blockquote>
<p>Error: Request failed with status code 401</p>
</blockquote>
<p>This isn't surprising since, if you recall, earlier we set up the API <code>signIn</code> endpoint to do just this:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'error'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'invalid_credentials'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><code>401</code> is the HTTP status code that means <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401"><code>Unauthorized</code></a>. So in our <code>axios</code> call we could check for this code and if it's present show an appropriate error message. First let's add an <code>error</code> property to the <code>state</code> of <code>Login</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
    email<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    error<span class="token punctuation">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Then we can change the <code>catch</code> part of our <code>axios</code> call to check for the <code>401</code> status, and update the <code>error</code> state accordingly:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> status <span class="token operator">=</span> error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">'Username or password not recognised.'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Finally in our <code>render</code> method we check to see if the error is an empty string - if not just display it in a <code>p</code> tag with a Bootstrap css helper class:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>h1<span class="token operator">></span>Login<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>error <span class="token operator">!==</span> <span class="token string">''</span> <span class="token operator">?</span>
    <span class="token operator">&lt;</span>p className<span class="token operator">=</span><span class="token string">"text-danger"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>error<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token punctuation">:</span>
    <span class="token keyword">null</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now when you try to log in with false credentials you will get this message. But we do need to reset it when login is successful otherwise the message will remain on the screen. So add a line to do this just before we authenticate:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<h4>Refreshing expired tokens</h4>
<p>By default the jwt-auth package expires its tokens after 1 hour. We need a way to check whether the current token has expired, and if so, to refresh it. For the purposes of testing it might be helpful to set the expiry time to a smaller value - this can be done in <code>config/jwt.php</code>. I've set the <code>ttl</code> value ('time to live') to <code>1</code> (i.e. one minute). Don't forget to set it back to <code>60</code> (or whatever you want) when you've finished testing.</p>
<p>Now, when a token has expired, if we try to make a call to the <code>clients</code> API endpoint we'll get a <code>401</code> error, just like when the user is not logged in. So to distinguish between these two cases, we'll check that a) the user <em>is</em> logged in, and b) we get a <code>401</code> response from our API. If both of these are <code>true</code>, then we can ask to refresh the token.</p>
<p>First let's set up the Laravel API side of things. We want a new endpoint, <code>refreshToken</code>. So in the <code>api.php</code> routes file, add this line under the <code>signup</code> and <code>signin</code> routes:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php">Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/refreshToken'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'FrontEndUserController@refreshToken'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Then in <code>FrontEndUserController</code> we'll add the <code>refreshToken</code> method:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">refreshToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$token</span> <span class="token operator">=</span> JWTAuth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token variable">$token</span> <span class="token operator">=</span> JWTAuth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>JWTException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'error'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'could_not_create_token'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This is pretty self-explanatory - get the current token, try to refresh it and if this succeeds return it as JSON. That's it for the server-side stuff.</p>
<p>Now, back on the client-side, we need to update our <code>getClients</code> method to make that check I talked about at the start of this section. So at the end of the <code>axios</code> call add this <code>catch</code> method:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> status <span class="token operator">=</span> error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">===</span> <span class="token number">401</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>isAuthenticated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// logged in but invalid jwt</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>This just checks that we're getting a <code>401</code> status response and that the user has been authenticated: if so, call a <code>refresh</code> method that sits in the parent component. Now go to the <code>App</code> component and add this method:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/refreshToken'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        headers<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">'Authorization'</span><span class="token punctuation">:</span> <span class="token string">'Bearer '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>token <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> token <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error!'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>(Don't forget to bind this method in the constructor, and to pass it as a prop via the <code>PrivateRoute</code>: <code>refresh={this.refresh}</code>.) Here we're making a call to our recently-created <code>refreshToken</code> endpoint (passing our app's current token in the header). When we get the token back, we just update the state's <code>token</code> value with the <code>authenticate</code> method we created a while ago. Since this <code>token</code> value is passed as a prop to the <code>Clients</code> component, it will have the new token value automatically. But we still need to check for this change and re-call the <code>clients</code> endpoint with the new token. We can do this using the <a href="https://facebook.github.io/react/docs/react-component.html#componentdidupdate"><code>componentDidUpdate</code></a> lifecycle hook.</p>
<p>So back in the <code>Clients</code> component, add this hook:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevProps<span class="token punctuation">.</span>token <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClients</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>All this does is to see if the new token property is different from the previous token property: if it is, we need to get our client list again.</p>
<h4>Persisting tokens with localStorage</h4>
<p>As the app currently stands, if you refresh the page the token will be erased and the user will have to log in again. We need a way to persist the token between sessions - for this we'll use <a href="https://developer.mozilla.org/en/docs/Web/API/Window/localStorage">localStorage</a>. We need to give the value a key name - let's call it <code>jwt</code>. In the <code>authenticate</code> method in <code>App.js</code> we just need to use the <code>localStorage.setItem</code> command to persist the token to the browser:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'jwt'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>You can check the token's being saved using the Chrome (under Application -> Local Storage) or Firefox (under Storage) dev-tools. Now, whenever the app loads, all we need to do is to check <code>localStorage</code> for the <code>jwt</code> key, and if it exists set its value to be our app's token. As usual we can do this with the <code>componentWillMount</code> lifecycle hook:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> lsToken <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'jwt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>lsToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span>lsToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>If there's no token in there, <code>getItem</code> will return <code>null</code> and nothing will happen. If there is one there, we call <code>authenticate</code> which updates the app's <code>state</code> with the saved token.</p>
<p>Finito. This has been a tutorial on setting up JWT authentication to allow a React app to communicate with a Laravel API. All the code is available <a href="https://github.com/unlikenesses/react-laravel-jwt">here</a>.</p></div></div></article><div class="w-full flex pt-6"><a class="w-1/2 bg-white shadow hover:shadow-md text-left p-6 no-underline" href="/2017-07-31-redux-with-local-storage/"><p class="text-lg text-gray-700 font-bold flex items-center">Previous<!-- -->:</p><p class="pt-2 capitalize">redux with local storage<!-- --> <small>31 July, 2017</small></p></a><a class="w-1/2 bg-white shadow hover:shadow-md text-left p-6 no-underline" href="/2018-01-10-migrating-blog-to-gatsby/"><p class="text-lg text-gray-700 font-bold flex items-center">Next<!-- -->:</p><p class="pt-2 capitalize">Migrating the blog from Jekyll to Gatsby<!-- --> <small>10 January, 2018</small></p></a></div></section></div><footer class="container mx-auto flex flex-wrap py-4 px-5 justify-between text-gray-600"><p>Unlikenesses</p><p>Built with <a href="https://www.gatsbyjs.org" target="_blank">GatsbyJS</a> and <a href="https://tailwindcss.com" target="_blank">Tailwind CSS</a></p></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2017-08-10-jwts-with-react-and-laravel/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-d804ca8346e83b6629a1.js"],"component---src-templates-index-js":["/component---src-templates-index-js-20aed7baa943eb5e92df.js"],"component---src-templates-post-js":["/component---src-templates-post-js-f482eaf3e97d399ee61e.js"],"component---src-pages-404-js":["/component---src-pages-404-js-224a4a61ab9775ba900d.js"]};/*]]>*/</script><script src="/component---src-templates-post-js-f482eaf3e97d399ee61e.js" async=""></script><script src="/styles-7cbd95f2e426d3237055.js" async=""></script><script src="/app-d804ca8346e83b6629a1.js" async=""></script><script src="/commons-e4d1cf937e8afc4814a6.js" async=""></script><script src="/webpack-runtime-9dc4e232ce5257c7390e.js" async=""></script></body></html>