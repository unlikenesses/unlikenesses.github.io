<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.7371b6fbed938cdba466.css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}

/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}a{background-color:transparent}small{font-size:80%}h1,p{margin:0}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e2e8f0}h1{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}.bg-white{--bg-opacity:1;background-color:#fff;background-color:rgba(255,255,255,var(--bg-opacity))}.bg-gray-100{--bg-opacity:1;background-color:#f7fafc;background-color:rgba(247,250,252,var(--bg-opacity))}.bg-gray-300{--bg-opacity:1;background-color:#e2e8f0;background-color:rgba(226,232,240,var(--bg-opacity))}.hover\:bg-gray-400:hover{--bg-opacity:1;background-color:#cbd5e0;background-color:rgba(203,213,224,var(--bg-opacity))}.rounded{border-radius:.25rem}.flex{display:flex}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-between{justify-content:space-between}.font-bold{font-weight:700}.text-sm{font-size:.875rem}.text-lg{font-size:1.125rem}.text-xl{font-size:1.25rem}.text-3xl{font-size:1.875rem}.text-5xl{font-size:3rem}.my-4{margin-top:1rem;margin-bottom:1rem}.mx-auto{margin-left:auto;margin-right:auto}.mr-3{margin-right:.75rem}.p-6{padding:1.5rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.px-4{padding-left:1rem;padding-right:1rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.pt-2{padding-top:.5rem}.pb-3{padding-bottom:.75rem}.pb-5{padding-bottom:1.25rem}.pl-5{padding-left:1.25rem}.pt-6{padding-top:1.5rem}.pb-6{padding-bottom:1.5rem}.shadow{box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06)}.hover\:shadow-md:hover{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}.text-left{text-align:left}.text-gray-800{--text-opacity:1;color:#2d3748;color:rgba(45,55,72,var(--text-opacity))}.text-pink-600{--text-opacity:1;color:#d53f8c;color:rgba(213,63,140,var(--text-opacity))}.hover\:text-gray-700:hover{--text-opacity:1;color:#4a5568;color:rgba(74,85,104,var(--text-opacity))}.uppercase{text-transform:uppercase}.capitalize{text-transform:capitalize}.no-underline{text-decoration:none}.hover\:underline:hover{text-decoration:underline}.w-1\/2{width:50%}.w-full{width:100%}.nunito{font-family:Nunito,sans-serif}p{margin-bottom:.75rem}a{--text-opacity:1;color:#ed64a6;color:rgba(237,100,166,var(--text-opacity));text-decoration:underline}</style><meta name="generator" content="Gatsby 2.18.17"/><link href="https://fonts.googleapis.com/css?family=Nunito:400,700" rel="stylesheet"/><link as="script" rel="preload" href="/webpack-runtime-b4f9663c8c66499d7c8d.js"/><link as="script" rel="preload" href="/app-75c380aa823ade8e7cd6.js"/><link as="script" rel="preload" href="/styles-89302ffc91d24a21370e.js"/><link as="script" rel="preload" href="/commons-5705c9267cfc5d8183ec.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-6867365149186f8c8c2f.js"/><link as="fetch" rel="preload" href="/page-data\2018-01-10-migrating-blog-to-gatsby\page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="bg-gray-100 nunito"><div class="container mx-auto flex flex-wrap py-6"><header class="pl-5 pb-6"><a class="font-bold text-gray-800 uppercase hover:text-gray-700 text-5xl no-underline" href="/">Unlikenesses <span class="text-xl">A PHP Developer</span></a><nav><a class="no-underline mr-3 text-gray-800" href="https://twitter.com/unlikenesses" target="_blank" rel="noopener noreferrer">Twitter</a><a class="no-underline mr-3 text-gray-800" href="https://github.com/unlikenesses" target="_blank" rel="noopener noreferrer">GitHub</a><a class="no-underline text-gray-800" href="http://codepen.io/unlikenesses/" target="_blank" rel="noopener noreferrer">CodePen</a></nav></header><section class="w-full flex flex-col items-center px-3"><article class="w-full flex flex-col shadow my-4"><div class="bg-white flex flex-col justify-start p-6"><h1 class="text-3xl font-bold hover:text-gray-700 capitalize">Migrating the blog from Jekyll to Gatsby</h1><span class="text-sm pb-3">10 January, 2018</span><div><p>Notes on converting this blog from a <a href="https://jekyllrb.com">Jekyll</a>-generated site (with the <a href="https://github.com/poole/hyde">Hyde</a> theme) to the React-based <a href="https://www.gatsbyjs.org">Gatsby.js</a>, retaining the same theme. The source code <a href="https://github.com/unlikenesses/unlikenesses.github.io/tree/v2.0">can be found here</a>.</p>
<h2>Getting started</h2>
<p>After installing Gatsby on my machine, the first step is to create a new project using its "hello world" scaffolding:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">gatsby new blog-gatsby https://github.com/gatsbyjs/gatsby-starter-hello-world</code></pre></div>
<p>The first thing I want to do is check I can display the posts I already have on the Jekyll blog, with its basic look-and-feel, leaving most of the functionality to later. To speed things up, I won't be using Gatsby's built-in <a href="https://github.com/css-modules/css-modules">CSS Modules</a>; instead, I create a <code>css</code> folder in <code>src</code> and copy my CSS files there. Then I create a <code>layouts</code> folder in <code>src</code>, and create the basic layout, <code>index.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Sidebar <span class="token keyword">from</span> <span class="token string">"./sidebar"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"../css/poole.css"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"../css/hyde.css"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"theme-base-08"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>Sidebar <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"content container"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>This uses the same mark-up as the Hyde theme. My <code>sidebar</code> component is, for now, a simplified version of the Hyde sidebar (I don't automatically generate any links there yet). See the repo for <a href="https://github.com/unlikenesses/unlikenesses.github.io/blob/v2.0/src/layouts/sidebar.js">the final sidebar</a>. To get the Google fonts loaded I install the <a href="https://www.npmjs.com/package/gatsby-plugin-google-fonts">Gatsby Google fonts module</a>:</p>
<p><code>npm install gatsby-plugin-google-fonts --save</code></p>
<p>and put the details in the root <code>gatsby-config.js</code> file:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      resolve<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">gatsby-plugin-google-fonts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        fonts<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Roboto+Slab\:700</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Noto+Serif\:400,400i,700,700i</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<h2>Displaying posts</h2>
<p>The next step is to copy across the posts. Create a <code>posts</code> folder in <code>src</code> and copy the posts across from the Hyde <code>_posts</code> folder.</p>
<p>We'll need the <a href="https://www.npmjs.com/package/gatsby-source-filesystem">gatsby-source-filesystem</a> plugin for accessing the files, and the <a href="https://www.npmjs.com/package/gatsby-transformer-remark">gatsby-transformer-remark</a> plugin for parsing the markdown:</p>
<p><code>npm install --save gatsby-source-filesystem</code>
<code>npm install --save gatsby-transformer-remark</code></p>
<p>Updated config file (with the site title):</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  siteMetadata<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Unlikenesses</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      resolve<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">gatsby-plugin-google-fonts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        fonts<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Roboto+Slab\:700</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Noto+Serif\:400,400i,700,700i</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      resolve<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">gatsby-source-filesystem</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">src</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        path<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/src/</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">gatsby-transformer-remark</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Now we can pass the site title to the sidebar (<code>&#x3C;Sidebar title={data.site.siteMetadata.title} /></code>) with this graphQl query:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> query <span class="token operator">=</span> graphql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  query AboutQuery {
    site {
      siteMetadata {
        title
      }
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre></div>
<p>Now, the <code>pages/index.js</code> file just needs to grab the list of posts:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> query <span class="token operator">=</span> graphql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  query IndexQuery {
    allMarkdownRemark {
      totalCount
      edges {
        node {
          frontmatter {
            title
            date(formatString: "DD MMMM, YYYY")
          }
          excerpt
        }
      }
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre></div>
<p>and map over them, outputting the same markup as the original blog:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"posts"</span><span class="token operator">></span>
      <span class="token punctuation">{</span>data<span class="token punctuation">.</span>allMarkdownRemark<span class="token punctuation">.</span>edges<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> node <span class="token punctuation">}</span><span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"post"</span> key<span class="token operator">=</span><span class="token punctuation">{</span>idx<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>h1 className<span class="token operator">=</span><span class="token string">"post-title"</span><span class="token operator">></span><span class="token punctuation">{</span>node<span class="token punctuation">.</span>frontmatter<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
          <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">"post-date"</span><span class="token operator">></span><span class="token punctuation">{</span>node<span class="token punctuation">.</span>frontmatter<span class="token punctuation">.</span>date<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
          <span class="token operator">&lt;</span>div dangerouslySetInnerHTML<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> __html<span class="token punctuation">:</span> node<span class="token punctuation">.</span>excerpt <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>There's a problem with this though. The Hyde blog automatically takes the title and date of each post from the post's filename (unless otherwise specified in the front-matter). It'd be nice if we could do the same here. We'll cover that in the next section.</p>
<h2>Linking to a post</h2>
<p>At the moment we're only showing excerpts. To create and link to the actual posts we'll follow the official <a href="https://www.gatsbyjs.org/tutorial/part-four/#programmatically-creating-pages-from-data">tutorial</a>. So, create <code>gatsby-node.js</code>, and first, to create the slugs, paste in this code (taken more or less directly from the official docs):</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> createFilePath <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"gatsby-source-filesystem"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">onCreateNode</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> node<span class="token punctuation">,</span> getNode<span class="token punctuation">,</span> boundActionCreators <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> createNodeField <span class="token punctuation">}</span> <span class="token operator">=</span> boundActionCreators<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"MarkdownRemark"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> slug <span class="token operator">=</span> <span class="token function">createFilePath</span><span class="token punctuation">(</span><span class="token punctuation">{</span> node<span class="token punctuation">,</span> getNode<span class="token punctuation">,</span> basePath<span class="token punctuation">:</span> <span class="token string">"posts"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">createNodeField</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      node<span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> <span class="token string">"slug"</span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> slug
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>This will add a <code>slug</code> field to the list of markdown pages. But while we're adding fields, why not add new fields which contain the title and date of a post based on its filename? Under the <code>slug</code> declaration, we can add a small bit of JavaScript to parse the slug into date and title:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> title <span class="token operator">=</span> node<span class="token punctuation">.</span>frontmatter<span class="token punctuation">.</span>title<span class="token punctuation">;</span>
<span class="token keyword">let</span> date <span class="token operator">=</span> node<span class="token punctuation">.</span>frontmatter<span class="token punctuation">.</span>date<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>title <span class="token operator">===</span> <span class="token string">""</span> <span class="token operator">||</span> date <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> nameArr <span class="token operator">=</span> slug<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\//g</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  date <span class="token operator">=</span> nameArr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  title <span class="token operator">=</span> nameArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">".md"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>If the title or date are empty, we derive them from the slug. Remember the format of a slug is <code>/2018-01-01-title-of-post.md/</code>. First we remove the bounding <code>/</code> characters, then split it at its hyphens. Using <code>splice</code> we grab the first three elements of the resultant array, and join them up again to form the date. The title is the rest of the array, joined with spaces and with the final <code>.md</code> removed. Then we can create the new node fields:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">createNodeField</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  node<span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">"title"</span><span class="token punctuation">,</span>
  value<span class="token punctuation">:</span> title
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">createNodeField</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  node<span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">"date"</span><span class="token punctuation">,</span>
  value<span class="token punctuation">:</span> <span class="token function">moment</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"DD MMMM, YYYY"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>I'm importing <a href="https://momentjs.com">Moment.js</a> at the top of the file, and using it here to format the date. It comes with Gatsby's node modules so there's no need to install it separately. (NB. You'll need to stop and restart the Gatsby server.)</p>
<p>Now we return to <code>pages/index.js</code>. Import <code>Link</code> at the top:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">"gatsby-link"</span><span class="token punctuation">;</span></code></pre></div>
<p>Now we can replace the <code>h1</code> tag with</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token punctuation">{</span>node<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>slug<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">"post-title"</span><span class="token operator">></span>
  <span class="token punctuation">{</span>node<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>title<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span></code></pre></div>
<p>Notice here we're pulling the <code>slug</code> and <code>title</code> fields from the node. We can do the same with the date:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">"post-date"</span><span class="token operator">></span><span class="token punctuation">{</span>node<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>date<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span></code></pre></div>
<p>To pull in this data we just need to modify the GraphQL query to include the new fields:</p>
<div class="gatsby-highlight" data-language="graphql"><pre class="language-graphql"><code class="language-graphql">node <span class="token punctuation">{</span>
  id
  fileAbsolutePath
  frontmatter <span class="token punctuation">{</span>
    title
    date<span class="token punctuation">(</span><span class="token attr-name">formatString</span><span class="token punctuation">:</span> <span class="token string">"DD MMMM, YYYY"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  fields <span class="token punctuation">{</span>
    slug
    title
    date
  <span class="token punctuation">}</span>
  excerpt
<span class="token punctuation">}</span></code></pre></div>
<p>Now we need to create the pages these <code>Link</code> tags point to. Back in <code>gatsby-node.js</code> add the <code>createPages</code> function (taken from the official docs):</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">exports<span class="token punctuation">.</span><span class="token function-variable function">createPages</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> graphql<span class="token punctuation">,</span> boundActionCreators <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> createPage <span class="token punctuation">}</span> <span class="token operator">=</span> boundActionCreators<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">graphql</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      {
        allMarkdownRemark {
          edges {
            node {
              fields {
                slug
              }
            }
          }
        }
      }
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>allMarkdownRemark<span class="token punctuation">.</span>edges<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> node <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">createPage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          path<span class="token punctuation">:</span> node<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>slug<span class="token punctuation">,</span>
          component<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./src/templates/post.js"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          context<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// Data passed to context is available in page queries as GraphQL variables.</span>
            slug<span class="token punctuation">:</span> node<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>slug
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>The only change I've made is to modify the location and filename of the individual post component. We can create that now. The React function just renders the HTML:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> post <span class="token operator">=</span> data<span class="token punctuation">.</span>markdownRemark<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"post"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>h1 className<span class="token operator">=</span><span class="token string">"post-title"</span><span class="token operator">></span><span class="token punctuation">{</span>post<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">"post-date"</span><span class="token operator">></span><span class="token punctuation">{</span>post<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>date<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
      <span class="token operator">&lt;</span>div dangerouslySetInnerHTML<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> __html<span class="token punctuation">:</span> post<span class="token punctuation">.</span>html <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>and the GraphQL query pulls in the appropriate data, based on the slug passed to it:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> query <span class="token operator">=</span> graphql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  query BlogPostQuery($slug: String!) {
    markdownRemark(fields: { slug: { eq: $slug } }) {
      html
      fields {
        title
        date
      }
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre></div>
<h2>Ordering Posts</h2>
<p>To order the posts by date (which amounts to ordering them by filename), we add a <code>sort</code> statement to the GraphQL query:</p>
<div class="gatsby-highlight" data-language="graphql"><pre class="language-graphql"><code class="language-graphql">allMarkdownRemark<span class="token punctuation">(</span><span class="token attr-name">sort</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token attr-name">fields</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>fileAbsolutePath<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token attr-name">order</span><span class="token punctuation">:</span> <span class="token constant">DESC</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code></pre></div>
<p>One other detail: the Hyde blog hides (ha ha) all posts which have <code>published: false</code> in their front-matter. To replicate this we can add a simple filter to the query:</p>
<div class="gatsby-highlight" data-language="graphql"><pre class="language-graphql"><code class="language-graphql">allMarkdownRemark<span class="token punctuation">(</span><span class="token attr-name">sort</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token attr-name">fields</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>fileAbsolutePath<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token attr-name">order</span><span class="token punctuation">:</span> <span class="token constant">DESC</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token attr-name">filter</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token attr-name">frontmatter</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token attr-name">published</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token attr-name">eq</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code></pre></div>
<p>Let's also add a filter to grab only pages of the type "post" - we'll need this later:</p>
<div class="gatsby-highlight" data-language="graphql"><pre class="language-graphql"><code class="language-graphql">allMarkdownRemark<span class="token punctuation">(</span><span class="token attr-name">sort</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token attr-name">fields</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>fileAbsolutePath<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token attr-name">order</span><span class="token punctuation">:</span> <span class="token constant">DESC</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token attr-name">filter</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token attr-name">frontmatter</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token attr-name">published</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token attr-name">eq</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token attr-name">layout</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token attr-name">eq</span><span class="token punctuation">:</span> <span class="token string">"post"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code></pre></div>
<h2>Pagination</h2>
<p>The Hyde blog has "Newer" and "Older" links at the bottom of each page, with the pagination value being set in its <code>_config.yml</code> file. Pagination isn't supported out of the box in Gatsby at the time of writing, but there is <a href="https://www.npmjs.com/package/gatsby-paginate">this module</a>, which looks promising. Following the <a href="https://github.com/pixelstew/gatsby-paginate/">instructions</a>, first install the package: <code>npm install gatsby-paginate --save</code>. Then require it at the top of <code>gatsby-node.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> createPaginatedPages <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gatsby-paginate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Then call <code>createPaginatedPages</code> before the <code>createPage</code> function:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">createPaginatedPages</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  edges<span class="token punctuation">:</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>allMarkdownRemark<span class="token punctuation">.</span>edges<span class="token punctuation">,</span>
  createPage<span class="token punctuation">:</span> createPage<span class="token punctuation">,</span>
  pageTemplate<span class="token punctuation">:</span> <span class="token string">"src/templates/index.js"</span><span class="token punctuation">,</span>
  pageLength<span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Next we need to modify the <code>createPages</code> GraphQL query to match the one in <code>pages/index.js</code>, and finally create <code>src/templates/index.js</code>. This will be a combination of the example function from the <a href="https://github.com/pixelstew/gatsby-paginate/">docs</a> and the markup from <code>pages/index.js</code>, with some extra pagination mark-up from the old Hyde blog:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">NavLink</span> <span class="token operator">=</span> <span class="token parameter">props</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>props<span class="token punctuation">.</span>test<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>url<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">"pagination-item"</span><span class="token operator">></span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">"pagination-item"</span><span class="token operator">></span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>text<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>data<span class="token punctuation">,</span> pathContext<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> group<span class="token punctuation">,</span> index<span class="token punctuation">,</span> first<span class="token punctuation">,</span> last <span class="token punctuation">}</span> <span class="token operator">=</span> pathContext<span class="token punctuation">;</span>
  <span class="token keyword">const</span> previousUrl <span class="token operator">=</span> index <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">""</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> nextUrl <span class="token operator">=</span> <span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token punctuation">{</span>group<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> node <span class="token punctuation">}</span><span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"post"</span> key<span class="token operator">=</span><span class="token punctuation">{</span>idx<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token punctuation">{</span>node<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>slug<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">"post-title"</span><span class="token operator">></span>
            <span class="token punctuation">{</span>node<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>title<span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span>
          <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">"post-date"</span><span class="token operator">></span><span class="token punctuation">{</span>node<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>date<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
          <span class="token operator">&lt;</span>div dangerouslySetInnerHTML<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> __html<span class="token punctuation">:</span> node<span class="token punctuation">.</span>excerpt <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token punctuation">{</span>node<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>slug<span class="token punctuation">}</span><span class="token operator">></span>Read More <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"pagination"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>NavLink test<span class="token operator">=</span><span class="token punctuation">{</span>last<span class="token punctuation">}</span> url<span class="token operator">=</span><span class="token punctuation">{</span>nextUrl<span class="token punctuation">}</span> text<span class="token operator">=</span><span class="token string">"Older"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>NavLink test<span class="token operator">=</span><span class="token punctuation">{</span>first<span class="token punctuation">}</span> url<span class="token operator">=</span><span class="token punctuation">{</span>previousUrl<span class="token punctuation">}</span> text<span class="token operator">=</span><span class="token string">"Newer"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This should be mostly self-explanatory - take a look at the pagination package docs if you want to find out more. Don't forget to delete <code>pages/index.js</code>.</p>
<h2>Syntax highlighting</h2>
<p>We're still missing syntax highlighting - luckily there's a plugin for this: <code>npm install --save gatsby-remark-prismjs</code>. <a href="https://www.npmjs.com/package/gatsby-remark-prismjs">Gatsby-remark-prismjs</a> uses <a href="http://prismjs.com">PrismJS</a> to add syntax highlighting to markdown files. After it's installed we add it as a plugin in the <code>options</code> for <code>gatsby-transformer-remark</code>, in<code>gatsby-config.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
  resolve<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">gatsby-transformer-remark</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        resolve<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">gatsby-remark-prismjs</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>Then import the CSS in <code>layouts/index.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token string">"prismjs/themes/prism-tomorrow.css"</span><span class="token punctuation">;</span></code></pre></div>
<h2>Other pages</h2>
<p>We're almost there. In my blog there's a couple of static pages which are listed in the sidebar. I'll put those in the <code>pages</code> folder of the Gatsby blog, which should currently be empty. Each of these pages should have some front-matter: a "layout" (set to "page"), a "published" setting, and a "title". E.g.:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">---
title: About
layout: page
published: true
---</code></pre></div>
<p>Now we'll need to modify <code>gatsby-node.js</code>. First, since these pages are in a different folder, we have to set that in the <code>basePath</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> basePath <span class="token operator">=</span> <span class="token string">"posts"</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>frontmatter<span class="token punctuation">.</span>layout <span class="token operator">===</span> <span class="token string">"page"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  basePath <span class="token operator">=</span> <span class="token string">"pages"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> slug <span class="token operator">=</span> <span class="token function">createFilePath</span><span class="token punctuation">(</span><span class="token punctuation">{</span> node<span class="token punctuation">,</span> getNode<span class="token punctuation">,</span> basePath <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>We're just checking to see if the page has a <code>layout</code> attribute of "page", and if so, we alter the <code>basePath</code> variable and pass it in when creating the slug. We also need to check for the layout when creating the <code>date</code> node, since we don't need it in this case:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>frontmatter<span class="token punctuation">.</span>layout <span class="token operator">!==</span> <span class="token string">"page"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">createNodeField</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    node<span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">"date"</span><span class="token punctuation">,</span>
    value<span class="token punctuation">:</span> <span class="token function">moment</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"DD MMMM, YYYY"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now currently the GraphQL query for <code>createPages</code> gets both the posts and the pages. We need to make two queries, one for the posts, one for the pages. we need some extra info when creating the pages. So give the "posts" query a name:</p>
<div class="gatsby-highlight" data-language="graphql"><pre class="language-graphql"><code class="language-graphql"><span class="token attr-name">posts</span><span class="token punctuation">:</span> allMarkdownRemark<span class="token punctuation">(</span></code></pre></div>
<p>(This means we need to rename the object of the <code>createPaginatedPages</code> and <code>map</code> methods underneath, from <code>allMarkdownRemark</code> to <code>posts</code>.) Then under that create a new query called "pages":</p>
<div class="gatsby-highlight" data-language="graphql"><pre class="language-graphql"><code class="language-graphql"><span class="token attr-name">pages</span><span class="token punctuation">:</span> allMarkdownRemark<span class="token punctuation">(</span>
  <span class="token attr-name">sort</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">fields</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>fileAbsolutePath<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token attr-name">order</span><span class="token punctuation">:</span> <span class="token constant">DESC</span> <span class="token punctuation">}</span>
  <span class="token attr-name">filter</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">frontmatter</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">published</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">eq</span><span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token attr-name">layout</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">eq</span><span class="token punctuation">:</span> <span class="token string">"page"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  edges <span class="token punctuation">{</span>
    node <span class="token punctuation">{</span>
      fields <span class="token punctuation">{</span>
        title
        slug
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This is almost exactly the same as "posts", except that it filters for pages with the "page" <code>layout</code> attribute in the front matter. The final step here is to <code>map</code> over the results of the query and create the pages, passing a different template, <code>page.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>pages<span class="token punctuation">.</span>edges<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> node <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">createPage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> node<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>slug<span class="token punctuation">,</span>
    component<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./src/templates/page.js"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Now we have the pages we can link to them in our sidebar. I make the query in <code>layouts/index.js</code> and pass the result to the sidebar component:</p>
<div class="gatsby-highlight" data-language="graphql"><pre class="language-graphql"><code class="language-graphql">allMarkdownRemark<span class="token punctuation">(</span>
  <span class="token attr-name">sort</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">fields</span><span class="token punctuation">:</span>  <span class="token punctuation">[</span>frontmatter___title<span class="token punctuation">]</span><span class="token punctuation">}</span>
  <span class="token attr-name">filter</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">frontmatter</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">layout</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">eq</span><span class="token punctuation">:</span> <span class="token string">"page"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  edges <span class="token punctuation">{</span>
    node <span class="token punctuation">{</span>
      fields <span class="token punctuation">{</span>
        title
        slug
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>With the filter I only get the pages with a "page" layout. Then I pass them to the sidebar component:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>Sidebar
  title<span class="token operator">=</span><span class="token punctuation">{</span>data<span class="token punctuation">.</span>site<span class="token punctuation">.</span>siteMetadata<span class="token punctuation">.</span>title<span class="token punctuation">}</span>
  description<span class="token operator">=</span><span class="token punctuation">{</span>data<span class="token punctuation">.</span>site<span class="token punctuation">.</span>siteMetadata<span class="token punctuation">.</span>description<span class="token punctuation">}</span>
  pages<span class="token operator">=</span><span class="token punctuation">{</span>data<span class="token punctuation">.</span>allMarkdownRemark<span class="token punctuation">.</span>edges<span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">></span></code></pre></div>
<p>In <code>Sidebar.js</code> I just need to map over them and display a link:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>pages<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">page<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Link
      className<span class="token operator">=</span><span class="token string">"sidebar-nav-item"</span>
      to<span class="token operator">=</span><span class="token punctuation">{</span>page<span class="token punctuation">.</span>node<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>slug<span class="token punctuation">}</span>
      key<span class="token operator">=</span><span class="token punctuation">{</span>idx<span class="token punctuation">}</span>
    <span class="token operator">></span>
      <span class="token punctuation">{</span>page<span class="token punctuation">.</span>node<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>title<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre></div>
<p>The final step is to create the page template, <code>templates/page.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> data<span class="token punctuation">.</span>markdownRemark<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>h1 className<span class="token operator">=</span><span class="token string">"page-title"</span><span class="token operator">></span><span class="token punctuation">{</span>page<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
      <span class="token operator">&lt;</span>div dangerouslySetInnerHTML<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> __html<span class="token punctuation">:</span> page<span class="token punctuation">.</span>html<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> query <span class="token operator">=</span> graphql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  query PageQuery($slug: String!) {
    markdownRemark(fields: { slug: { eq: $slug } }) {
      html
      fields {
        title
      }
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre></div>
<p>It's basically a much simpler version of <code>post.js</code>, since we only want the <code>title</code> and <code>html</code> fields.</p>
<h2>Related Posts</h2>
<p>Since what Jekyll calls "Related Posts" is <a href="https://jekyllrb.com/docs/variables/">actually just "Recent Posts"</a>, I decided to ditch it in favour of "previous / next post" links. We can get the previous and next posts in our GraphQL query in <code>gatsby-node.js</code>. (Much of this is derived from <a href="https://github.com/iansinnott">Ian Sinnott's</a> <a href="https://github.com/iansinnott/iansinnott.github.io/blob/source/gatsby-node.js"><code>gatsby-node.js</code></a>):</p>
<div class="gatsby-highlight" data-language="graphql"><pre class="language-graphql"><code class="language-graphql">next<span class="token punctuation">{</span>
  fields <span class="token punctuation">{</span>
    title
    slug
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
previous <span class="token punctuation">{</span>
  fields <span class="token punctuation">{</span>
    title
    slug
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>and pass them in the context (swapping them around, since "next" gives us an older post):</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">createPage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  path<span class="token punctuation">:</span> node<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>slug<span class="token punctuation">,</span>
  component<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./src/templates/post.js"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  context<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    slug<span class="token punctuation">:</span> node<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>slug<span class="token punctuation">,</span>
    prev<span class="token punctuation">:</span> next<span class="token punctuation">,</span>
    next<span class="token punctuation">:</span> previous
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Now we have the previous and next results we can display the links accordingly in <code>post.js</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"related"</span><span class="token operator">></span>
  <span class="token punctuation">{</span>pathContext<span class="token punctuation">.</span>prev <span class="token operator">?</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>h3<span class="token operator">></span>
        Previous<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">" "</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token punctuation">{</span>pathContext<span class="token punctuation">.</span>prev<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>slug<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token punctuation">{</span>pathContext<span class="token punctuation">.</span>prev<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>title<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span>
  <span class="token punctuation">{</span>pathContext<span class="token punctuation">.</span>next <span class="token operator">?</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>h3<span class="token operator">></span>
        Next<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">" "</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token punctuation">{</span>pathContext<span class="token punctuation">.</span>next<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>slug<span class="token punctuation">}</span><span class="token operator">></span>
          <span class="token punctuation">{</span>pathContext<span class="token punctuation">.</span>next<span class="token punctuation">.</span>fields<span class="token punctuation">.</span>title<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></code></pre></div>
<p><a href="https://github.com/unlikenesses/unlikenesses.github.io/tree/v2.0">Full source code.</a></p></div></div></article><div class="w-full flex pt-6"><a class="w-1/2 bg-white shadow hover:shadow-md text-left p-6 no-underline" href="/2017-08-10-jwts-with-react-and-laravel/"><p class="text-lg text-gray-800 font-bold flex items-center">Previous<!-- -->:</p><p class="pt-2 capitalize">JWTs with React and Laravel<!-- --> <small>10 August, 2017</small></p></a><a class="w-1/2 bg-white shadow hover:shadow-md text-left p-6 no-underline" href="/2018-02-20-http-components/"><p class="text-lg text-gray-800 font-bold flex items-center">Next<!-- -->:</p><p class="pt-2 capitalize">Why an HTTP component?<!-- --> <small>20 February, 2018</small></p></a></div></section></div><footer class="container mx-auto flex flex-wrap py-4 pl-5"><p> <!-- -->2020<!-- --> Unlikenesses</p></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2018-01-10-migrating-blog-to-gatsby/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-75c380aa823ade8e7cd6.js"],"component---src-templates-index-js":["/component---src-templates-index-js-ae34d3afc8e89f50bee5.js"],"component---src-templates-post-js":["/component---src-templates-post-js-6867365149186f8c8c2f.js"],"component---src-pages-404-js":["/component---src-pages-404-js-224a4a61ab9775ba900d.js"]};/*]]>*/</script><script src="/component---src-templates-post-js-6867365149186f8c8c2f.js" async=""></script><script src="/commons-5705c9267cfc5d8183ec.js" async=""></script><script src="/styles-89302ffc91d24a21370e.js" async=""></script><script src="/app-75c380aa823ade8e7cd6.js" async=""></script><script src="/webpack-runtime-b4f9663c8c66499d7c8d.js" async=""></script></body></html>